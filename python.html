<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>G+Smo: Using G+Smo in Python</title>
<link href="gismodoxy_tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://people.ricam.oeaw.ac.at/gismo/mj/MathJax.js"></script>
<link href="doxygen.css"   rel="stylesheet" type="text/css" />
<link href="gismodoxy.css" rel="stylesheet" type="text/css">
<!--  -->
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gslogo-doxy.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="index.html"><font style="font-variant:small-caps;">G+S</font><font style="font-variant:small-caps;"
															    color="#000000">mo</font></a>
   &#160;<span id="projectnumber">24.08.0</span>
   </div>
   <div id="projectbrief">Geometry + Simulation Modules</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('python.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using G+Smo in Python</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>G+Smo currently has two separate sets of Python bindings: Bindings based on <a href="https://github.com/pybind/pybind11">pybind11</a> and bindings based on <a href="https://cppyy.readthedocs.io/en/latest/">cppyy</a>. The main difference is that the pybind11-bindings are precompiled while the cppyy-bindings are based on JIT and are generated at runtime.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
cppyy bindings</h1>
<p>Cppyy-bindings are generated at runtime based on just-in-time compilation. For using G+Smo this is useful, since the bilinear forms are usually assembled using the expression assembler. Since <a class="el" href="classgismo_1_1gsExprAssembler.html">gismo::gsExprAssembler</a> is based on templated expressions, its assembly method can only be compiled once the bilinear form has been defined, which makes precompiled bindings impossible unless we restrict the available bilinear forms. Cppyy's just-in-time compilation solves this problem.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Configuration</h2>
<p>Configure G+Smo with the options <code>-DGISMO_WITH_CPPYY=On -DCMAKE_CXX_STANDARD=20</code>. This creates the Python package <code>gismo_cppyy</code> in the subdirectory <code>cppyy</code> of your build folder.</p>
<p>Then, build the <code>gismo</code> library as usual.</p>
<p>Run <code>make wheel</code> in order to generate the pip wheel in <code>cppyy/dist</code>. It can be installed with <code>make install-bindings</code> or directly using <code>pip</code>.</p>
<p>The package looks for the G+Smo sources in the source directory and for the shared library in the build directory. This means that these directories need to stay in place.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Usage</h2>
<p>The bindings can be imported in Python using </p><div class="fragment"><div class="line">from gismo_cppyy import gismo</div>
</div><!-- fragment --><p> All classes and functions from G+Smo can be found in the <code>gismo</code> namespace, templates are resolved using brackets containing either a string or a Python type. For example, you can access the expression assembler using </p><div class="fragment"><div class="line">A = gismo.gsExprAssembler[&quot;real_t&quot;]()</div>
</div><!-- fragment --><p> and, after defining the spaces and variables, assemble the matrix using </p><div class="fragment"><div class="line">A.assemble(gismo.expr.igrad(u, G) * gismo.expr.igrad(u, G).tr() * gismo.expr.meas(G), u * ff * gismo.expr.meas(G))</div>
</div><!-- fragment --><p> just as in C++. Before evaluating the <code>assemble()</code> method, the just-in-time compiler will compile the templated method </p><div class="fragment"><div class="line">template&lt;class... expr&gt; void assemble(const expr &amp;... args);</div>
</div><!-- fragment --><p> of <a class="el" href="classgismo_1_1gsExprAssembler.html">gismo::gsExprAssembler</a> for the employed expressions.</p>
<p>An example for solving the Poisson equation can be found in <code>python_examples/poisson_example_cppyy.py</code>. An additional example for adaptive fitting using THB-splines is in <code>python_examples/fitting_example_cppyy.py</code>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Numpy compatibility</h2>
<p>Data can be exchanged with numpy by converting numpy arrays into gismo objects and vice versa. The conversion from gismo objects to numpy arrays is done using the method <code>tonumpy()</code> of <a class="el" href="classgismo_1_1gsVector.html" title="A vector with arbitrary coefficient type and fixed or dynamic size.">gismo.gsVector</a>, <a class="el" href="classgismo_1_1gsMatrix.html" title="A matrix with arbitrary coefficient type and fixed or dynamic size.">gismo.gsMatrix</a> and <a class="el" href="classgismo_1_1gsAsMatrix.html" title="Creates a mapped object or data pointer to a matrix without copying data.">gismo.gsAsMatrix</a>. The class method <code>fromnumpy()</code> of these classes constructs a gismo object from a numpy array.</p>
<p>For example, you can run </p><div class="fragment"><div class="line">&gt;&gt;&gt; from gismo_cppyy import gismo</div>
<div class="line">&gt;&gt;&gt; import numpy as np</div>
<div class="line">&gt;&gt;&gt; a = np.array([[1,0],[0,1]], dtype=np.double)</div>
<div class="line">&gt;&gt;&gt; A = gismo.gsMatrix[&quot;double&quot;].fromnumpy(a)</div>
<div class="line">&gt;&gt;&gt; b = A.tonumpy()</div>
<div class="line">&gt;&gt;&gt; B = gismo.gsAsMatrix[&quot;double&quot;].fromnumpy(b)</div>
</div><!-- fragment --><p>Note that <code><a class="el" href="classgismo_1_1gsMatrix.html" title="A matrix with arbitrary coefficient type and fixed or dynamic size.">gismo.gsMatrix</a>["double"].fromnumpy()</code> copies the underlying data, while <code><a class="el" href="classgismo_1_1gsAsMatrix.html" title="Creates a mapped object or data pointer to a matrix without copying data.">gismo.gsAsMatrix</a>["double"].fromnumpy()</code> does not. <code>tonumpy()</code> never copies the data. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jan 7 2025 14:38:11 for G+Smo by Doxygen v1.9.8 </li>
  </ul>
</div>
<!-- Piwik --> 
<!--
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.sylphide-consulting.com/piwik/" : "http://stats.sylphide-consulting.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 20);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.sylphide-consulting.com/piwik/piwik.php?idsite=20" style="border:0" alt="" /></p></noscript>
-->
<!-- End Piwik Tracking Code -->
</body>
</html>
