<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>G+Smo: kirchhoff-Love_example.cpp</title>
<link href="gismodoxy_tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://people.ricam.oeaw.ac.at/gismo/mj/MathJax.js"></script>
<link href="doxygen.css"   rel="stylesheet" type="text/css" />
<link href="gismodoxy.css" rel="stylesheet" type="text/css">
<!--  -->
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gslogo-doxy.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="index.html"><font style="font-variant:small-caps;">G+S</font><font style="font-variant:small-caps;"
															    color="#000000">mo</font></a>
   &#160;<span id="projectnumber">25.01.0</span>
   </div>
   <div id="projectbrief">Geometry + Simulation Modules</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('kirchhoff-Love_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">kirchhoff-Love_example.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example, the Kirchhoff-Love shell is implemented. References for this implementation include the original work by Kiendl et. al. (2009) [1], the PhD thesis of Josef Kiendl (2011) [2], the PhD thesis of Anmol Goyal (2015) [3], the MSc thesis of Hugo Verhelst (2019) [4]. Anmol contributed to the first Kirchhoff-Love implementation of G+Smo and Hugo to the current one.</p>
<h1><a class="anchor" id="equations"></a>
Governing Equations</h1>
<p>The variational formulation for the Kirchhoff-Love shell is:  </p><p class="formulaDsp">
\begin{eqnarray*}
        \int_\Omega \mathbf{f}\cdot\mathbf{v}\ + p\mathbf{\hat{n}}:\text{d}\Omega - \int_\Omega \mathbf{n}(\mathbf{u}):\mathbf{\varepsilon}^\prime(\mathbf{u},\mathbf{v}) + \mathbf{m}(\mathbf{u}):\mathbf{\kappa}^\prime(\mathbf{u},\mathbf{v}) \text{d}\Omega = 0
\end{eqnarray*}
</p>
<p>The left-hand side of this formulation in fact is the residual of the problem, being the balance between external and internal forces. In this equation, \(\Omega\) is the domain, \( \mathbf{f} \) is a vector with a distributed load acting on the mid-plane of the shell, \( \mathbf{v} \) is the three-dimensional test function, \( p\) is a follower pressure acting on the shell, \( \mathbf{\hat{n}}\) is the shell normal, \( n \) is the normal-force tensor, \( \mathbf{\varepsilon}^\prime \) is the variation of the membrane strain tensor, \( \mathbf{m} \) is the bending moment tensor, \( \mathbf{\kappa}^\prime \) is the variation of the bending strain tensor and \(\mathbf{u} \) is the displacement of the mid-plane of the shell; thus the solution to the problem.</p>
<p>In order to solve the variational formulation for \( \mathbf{u} \), the second variation is derived, such that a lineararized form can be found or such that the Jacobian and for Newton iterations can be found. The second variation is:</p>
<p class="formulaDsp">
\begin{eqnarray*}
        j(\mathbf{u},\mathbf{v},\mathbf{w}) = \int_\Omega \mathbf{n}(\mathbf{u}):\mathbf{\varepsilon}^{\prime\prime}(\mathbf{u},\mathbf{v},\mathbf{v}) + \mathbf{n}^\prime(\mathbf{u},\mathbf{v}):\mathbf{\varepsilon}^{\prime}(\mathbf{u},\mathbf{v}) + \mathbf{m}(\mathbf{u}):\mathbf{\kappa}^{\prime\prime}(\mathbf{u},\mathbf{v},\mathbf{w}) + \mathbf{m}^\prime(\mathbf{u},\mathbf{v}):\mathbf{\kappa}^\prime(\mathbf{u},\mathbf{v}) \text{d}\Omega - \int_\Omega p \mathbf{v}\cdot\mathbf{\hat{n}}^\prime :\text{d}\Omega
\end{eqnarray*}
</p>
<p>In this equation, the primed ( \(\cdot^\prime\)) expressions again denote the first variation and the double-primed ( \(\cdot^{\prime\prime}\)) expressions denote second variations.</p>
<p>From the above equations, a system of equations can be assembled, which will later be done by the <a class="el" href="classgismo_1_1gsExprAssembler.html">gsExprAssembler</a> . In case of a lineararized system, only the single-primed expressions are non-zero, together with the term containing the external load.</p>
<p>The expressions for the strains, normal foce and bending moment are as follows (see sec. 3.2 and 3.3 of [3]):  </p><p class="formulaDsp">
\begin{align*}
        \varepsilon_{\alpha\beta} &amp;= \frac{\partial\mathbf{c}}{\partial\theta_\alpha}\cdot\frac{\partial\mathbf{c}}{\partial\theta_\beta} - \frac{\partial\mathbf{C}}{\partial\theta_\alpha}\cdot\frac{\partial\mathbf{C}}{\partial\theta_\beta}\\
        \varepsilon^\prime_{\alpha\beta} &amp;= \frac{1}{2}\frac{\partial\mathbf{v}}{\partial\theta_\alpha}\cdot\frac{\partial\mathbf{c}}{\partial\theta_\beta} + \frac{1}{2}\frac{\partial\mathbf{c}}{\partial\theta_\alpha}\cdot\frac{\partial\mathbf{v}}{\partial\theta_\beta} \\
        \kappa_{\alpha\beta} &amp;= \frac{\partial^2\mathbf{C}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{N}} - \frac{\partial^2\mathbf{c}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}}\\
        \kappa^\prime_{\alpha\beta} &amp;= \frac{\partial^2\mathbf{v}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}} + \frac{\partial^2\mathbf{c}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}}^\prime(\mathbf{u})\\
        \mathbf{\hat{n}}^\prime(\mathbf{v}) &amp;= \mathbf{m}_{\mathbf{v}} - (\mathbf{\hat{n}}\cdot \mathbf{m}_{\mathbf{v}})\mathbf{\hat{n}} \\
        \mathbf{m}_{\mathbf{v}} &amp;= \frac{1}{\vert \frac{\partial\mathbf{c}}{\partial\theta_1}\times \frac{\partial\mathbf{c}}{\partial\theta_2}\vert } \left( \frac{\partial\mathbf{v}}{\partial\theta_1}\times \frac{\partial\mathbf{c}}{\partial\theta_2} + \frac{\partial\mathbf{c}}{\partial\theta_1} \times \frac{\partial\mathbf{v}}{\partial\theta_2} \right)\\
        \varepsilon^{\prime\prime}_{\alpha\beta} &amp;= \frac{\partial\mathbf{v}}{\partial\theta_\alpha}\cdot\frac{\partial\mathbf{w}}{\partial\theta_\beta}\\
        \kappa^{\prime\prime}_{\alpha\beta} &amp;= \frac{\partial^2\mathbf{v}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}}^\prime(\mathbf{w}) + \frac{\partial^2\mathbf{w}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}}^\prime(\mathbf{v}) + \frac{\partial^2\mathbf{c}}{\partial\theta_\alpha\partial\theta_\beta}\cdot\mathbf{\hat{n}}^{\prime\prime}(\mathbf{v},\mathbf{w})\\
        \mathbf{\hat{n}}^{\prime\prime}(\mathbf{v},\mathbf{w}) &amp;= \mathbf{m}_{\mathbf{v}}^\prime - ( \mathbf{m}_{\mathbf{v}}\cdot\mathbf{\hat{n}}^\prime(\mathbf{w}) + \mathbf{\hat{n}}\cdot\mathbf{m}_{\mathbf{v}}^\prime(\mathbf{w}) )\mathbf{\hat{n}} - ( \mathbf{\hat{n}}\cdot \mathbf{m}_{\mathbf{v}} )\mathbf{\hat{n}}^\prime(\mathbf{w})\\
        \mathbf{m}_{\mathbf{v}}^{\prime}(\mathbf{w}) &amp;= \mathbf{m}_{\mathbf{vw}}-(\mathbf{n}\cdot\mathbf{m}_{\mathbf{w}})\mathbf{m}_{\mathbf{w}}\\
        \mathbf{m}_{\mathbf{vw}} &amp;= \frac{1}{\vert \frac{\partial\mathbf{c}}{\partial\theta_1}\times \frac{\partial\mathbf{c}}{\partial\theta_2}\vert } \left( \frac{\partial\mathbf{v}}{\partial\theta_1}\times \frac{\partial\mathbf{w}}{\partial\theta_2} + \frac{\partial\mathbf{w}}{\partial\theta_1} \times \frac{\partial\mathbf{v}}{\partial\theta_2} \right)\\
        n_{\alpha\beta} &amp;= t \mathcal{C}^{\alpha\beta\gamma\delta} \varepsilon_{\alpha\beta}\\
        n_{\alpha\beta}^\prime &amp;= \mathcal{C}^{\alpha\beta\gamma\delta} \varepsilon_{\alpha\beta}^{\prime}\\
        m_{\alpha\beta} &amp;= t \mathcal{C}^{\alpha\beta\gamma\delta} \kappa{\alpha\beta}\\
        m_{\alpha\beta}^\prime &amp;= \mathcal{C}^{\alpha\beta\gamma\delta} \kappa_{\alpha\beta}^{\prime}
\end{align*}
</p>
<p>Here, \( t\) is the thickness of the shell and \( \mathcal{C}^{\alpha\beta\gamma\delta}\) is the material tensor (see [3] eq. 3.15).</p>
<h1><a class="anchor" id="implementation"></a>
Implementation of the Kirchhoff-Love Shell</h1>
<p>Now we will have a look at the implementation in <code>kirchhoff-Love_example.cpp</code>.</p>
<p>The file starts with a large amount of classes being defined. These classes all inherit from the class <code>_expr</code> which means that they are G+Smo expressions. Without going into detail for the implementations of all the classes, the following functions match with the expressions defined above. Note that all these expressions are specific for the shell problem.</p><ul>
<li><code>var1_expr</code> resembles \( \mathbf{\hat{n}}^\prime\) and requires the space and the geometry.</li>
<li><code>var2_expr</code> resembles \( \mathbf{\hat{n}}^{\prime\prime} \cdot \mathbf{p} \) for an arbitrary vector \( \mathbf{p} \).</li>
<li><code>deriv2dot_expr</code> resembles either \( \frac{\partial^2\mathbf{v}}{\partial\theta_\alpha\partial\theta_\beta}\cdot \mathbf{p} \) or \( \frac{\partial^2\mathbf{c}}{\partial\theta_\alpha\partial\theta_\beta}\cdot \mathbf{p} \) for arbitrary vector \( \mathbf{p} \) space \( \mathbf{v}\) and geometry \( c \),</li>
<li><code>deriv2_expr</code> resembles either \( \frac{\partial^2\mathbf{v}}{\partial\theta_\alpha\partial\theta_\beta} \) or \( \frac{\partial^2\mathbf{c}}{\partial\theta_\alpha\partial\theta_\beta} \) for space \( \mathbf{v}\) or geometry \( c \),</li>
<li><code>flatdot_expr</code> is used to compute \( \mathbf{\varepsilon}^{\prime\prime}\cdot\mathbf{n}\) and its main purpose is memory-efficient implementation</li>
<li><code>flatdot2_expr</code> is used to compute the first two terms of \( \mathbf{\kappa}^{\prime\prime}\cdot\mathbf{m}\) and its main purpose is memory-efficient implementation</li>
<li><code>cartcov_expr</code> returns a transformation matrix between local covariant to local cartesian coordinates. The expression for its inverse, <code>cartcovinv_expr</code> is also implemented,</li>
<li><code>cartcov_expr</code> returns a transformation matrix between local contravariant to local cartesian coordinates. The expression for its inverse, <code>cartconinv_expr</code> is also implemented,</li>
</ul>
<p>After the shell-specific expressions, the material matrix class is defined, which is used to handle the material tensor $\mathcal{C}$. This class inherits from <a class="el" href="classgismo_1_1gsFunction.html">gsFunction</a> because it will later be used as a function to declare a variable in the <a class="el" href="classgismo_1_1gsExprAssembler.html">gsExprAssembler</a>.</p>
<p>Now, let us skip the implementation of the shell-specific expression implementations and the definition of the material matrix class. Before the main file starts, there are some forward declarations for functions that will help to define rectangular domains with arbitrary number of elements, order and length and width.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">gsMultiPatch&lt;T&gt; RectangularDomain(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> p, <span class="keywordtype">int</span> q, T L, T B);</div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">gsMultiPatch&lt;T&gt; RectangularDomain(<span class="keywordtype">int</span> n, <span class="keywordtype">int</span> p, T L, T B);</div>
</div><!-- fragment --><p>The first lines of our main file will handle the command line arguments for our script. This works similar to what can be seen in <a class="el" href="poisson2_example.html">poisson2_example.cpp</a>. For this particular case, there are multiple test cases that can be chosen, the flag for nonlinear simulation can be set and the usage of weak Dirichlet boundary conditions can be triggered for some test cases.</p>
<div class="fragment"><div class="line">    <span class="keywordtype">bool</span> plot = <span class="keyword">false</span>;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> numRefine  = 1;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> numElevate = 1;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> testCase = 1;</div>
<div class="line">    <span class="keywordtype">bool</span> weak = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> nonlinear = <span class="keyword">false</span>;</div>
<div class="line">    std::string fn;</div>
<div class="line"> </div>
<div class="line">    real_t E_modulus = 1.0;</div>
<div class="line">    real_t PoissonRatio = 0.0;</div>
<div class="line">    real_t thickness = 1.0;</div>
<div class="line"> </div>
<div class="line">    gsCmdLine cmd(<span class="stringliteral">&quot;Tutorial on solving a Poisson problem.&quot;</span>);</div>
<div class="line">    cmd.addInt( <span class="stringliteral">&quot;e&quot;</span>, <span class="stringliteral">&quot;degreeElevation&quot;</span>,</div>
<div class="line">                <span class="stringliteral">&quot;Number of degree elevation steps to perform before solving (0: equalize degree in all directions)&quot;</span>, numElevate );</div>
<div class="line">    cmd.addInt( <span class="stringliteral">&quot;r&quot;</span>, <span class="stringliteral">&quot;uniformRefine&quot;</span>, <span class="stringliteral">&quot;Number of Uniform h-refinement steps to perform before solving&quot;</span>,  numRefine );</div>
<div class="line">    cmd.addInt( <span class="stringliteral">&quot;t&quot;</span>, <span class="stringliteral">&quot;testCase&quot;</span>, <span class="stringliteral">&quot;Test case to run: 1 = unit square; 2 = Scordelis Lo Roof&quot;</span>,  testCase );</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;nl&quot;</span>, <span class="stringliteral">&quot;Solve nonlinear problem&quot;</span>, nonlinear);</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;plot&quot;</span>, <span class="stringliteral">&quot;Create a ParaView visualization file with the solution&quot;</span>, plot);</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;weak&quot;</span>, <span class="stringliteral">&quot;Weak BCs&quot;</span>, weak);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> { cmd.getValues(argc,argv); } <span class="keywordflow">catch</span> (<span class="keywordtype">int</span> rv) { <span class="keywordflow">return</span> rv; }</div>
<div class="ttc" id="agsConfig_8h_html_ad722078677c063a09661059674fb996c"><div class="ttname"><a href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a></div><div class="ttdeci">#define index_t</div><div class="ttdef"><b>Definition</b> gsConfig.h:32</div></div>
</div><!-- fragment --><p>Next up, we define the geometry and material data for different test cases. We define two multipatches; one to store the original geometry and one to store the deformed geometry. Furthermore, each test case requires a thickness, a Youngs modulus, a Poisson's ratio and a geometry.</p>
<div class="fragment"><div class="line">    gsMultiPatch&lt;&gt; mp;</div>
<div class="line">    gsMultiPatch&lt;&gt; mp_def;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (testCase == 2  || testCase == 3)</div>
<div class="line">    {</div>
<div class="line">        thickness = 0.25;</div>
<div class="line">        E_modulus = 4.32E8;</div>
<div class="line">        fn = <span class="stringliteral">&quot;surfaces/scordelis_lo_roof.xml&quot;</span>;</div>
<div class="line">        gsReadFile&lt;&gt;(fn, mp);</div>
<div class="line">        PoissonRatio = 0.0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (testCase == 6)</div>
<div class="line">    {</div>
<div class="line">        thickness = 0.1;</div>
<div class="line">        real_t mu = 4.225e5;</div>
<div class="line">        PoissonRatio = 0.3;</div>
<div class="line">        E_modulus = (2+PoissonRatio)*mu;</div>
<div class="line">        fn = <span class="stringliteral">&quot;surfaces/quarter_sphere.xml&quot;</span>;</div>
<div class="line">        gsReadFile&lt;&gt;(fn, mp);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Unit square</span></div>
<div class="line">        mp.addPatch( gsNurbsCreator&lt;&gt;::BSplineSquare(1) ); <span class="comment">// degree</span></div>
<div class="line">        mp.addAutoBoundaries();</div>
<div class="line">        mp.embed(3);</div>
<div class="line">        E_modulus = 1e0;</div>
<div class="line">        thickness = 1e0;</div>
<div class="line">        PoissonRatio = 0.0;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>In the following snippet, the geometry is refined and its degree is elevated.</p>
<div class="fragment"><div class="line">    <span class="comment">// p-refine</span></div>
<div class="line">    <span class="keywordflow">if</span> (numElevate!=0)</div>
<div class="line">        mp.degreeElevate(numElevate);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// h-refine</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r =0; r &lt; numRefine; ++r)</div>
<div class="line">        mp.uniformRefine();</div>
<div class="line">    mp_def = mp;</div>
<div class="line">    gsWriteParaview(mp,<span class="stringliteral">&quot;mp&quot;</span>,1000,<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">    gsMultiBasis&lt;&gt; dbasis(mp);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Patches: &quot;</span>&lt;&lt; mp.nPatches() &lt;&lt;<span class="stringliteral">&quot;, degree: &quot;</span>&lt;&lt; dbasis.minCwiseDegree() &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; dbasis.basis(0)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="ttc" id="agsDebug_8h_html_af6177e1e282640c3cb9175565f84a432"><div class="ttname"><a href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a></div><div class="ttdeci">#define gsInfo</div><div class="ttdef"><b>Definition</b> gsDebug.h:43</div></div>
</div><!-- fragment --><p>Now we define the boundary conditions, add the geometry map to the <a class="el" href="classgismo_1_1gsBoundaryConditions.html">gsBoundaryConditions</a> class and we define vectors for the implementation of the surface load (<code>tmp</code>), the neumann boundary conditions (<code>neu</code>) and functions are added for the imposed displacements, weak boundary conditions and the Neumann boundary conditions. We also have a scalar for applied pressures.</p>
<div class="fragment"><div class="line">    gsBoundaryConditions&lt;&gt; bc;</div>
<div class="line">    bc.setGeoMap(mp);</div>
<div class="line">    gsVector&lt;&gt; tmp(3);</div>
<div class="line">    tmp &lt;&lt; 0, 0, 0;</div>
<div class="line"> </div>
<div class="line">    gsVector&lt;&gt; neu(3);</div>
<div class="line">    neu &lt;&lt; 0, 0, 0;</div>
<div class="line"> </div>
<div class="line">    gsConstantFunction&lt;&gt; displx(0.09317696,3);</div>
<div class="line"> </div>
<div class="line">    gsConstantFunction&lt;&gt; neuData(neu,3);</div>
<div class="line">    gsConstantFunction&lt;&gt; weakBC(neu,3);</div>
<div class="line"> </div>
<div class="line">    real_t pressure = 0.0;</div>
</div><!-- fragment --><p>Now let us consider the definition of the individual test cases. The first case is a square plate (see geometry definition) where all boundaries are fixed in all directions. Note that the boundary conditions are applied per component (last entry) of the displacement.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (testCase == 1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i=0; i!=3; ++i)</div>
<div class="line">        {</div>
<div class="line">            bc.addCondition(boundary::north, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, i ); <span class="comment">// unknown 0 - x</span></div>
<div class="line">            bc.addCondition(boundary::east, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, i ); <span class="comment">// unknown 1 - y</span></div>
<div class="line">            bc.addCondition(boundary::south, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, i ); <span class="comment">// unknown 2 - z</span></div>
<div class="line">            bc.addCondition(boundary::west, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, i ); <span class="comment">// unknown 2 - z</span></div>
<div class="line">        }</div>
<div class="line">        tmp &lt;&lt; 0,0,-1;</div>
<div class="line">    }</div>
<div class="ttc" id="astructgismo_1_1condition__type_html_a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b"><div class="ttname"><a href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">gismo::condition_type::dirichlet</a></div><div class="ttdeci">@ dirichlet</div><div class="ttdoc">Dirichlet type.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:31</div></div>
</div><!-- fragment --><p>For the second test case, a corner is fixed.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (testCase == 2)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Diaphragm conditions</span></div>
<div class="line">        bc.addCondition(boundary::west, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, 1 ); <span class="comment">// unknown 1 - y</span></div>
<div class="line">        bc.addCondition(boundary::west, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, 2 ); <span class="comment">// unknown 2 - z</span></div>
<div class="line"> </div>
<div class="line">        bc.addCornerValue(boundary::southwest, 0.0, 0, 0, 0); <span class="comment">// (corner,value, patch, unknown, component)</span></div>
<div class="line"> </div>
<div class="line">        bc.addCondition(boundary::east, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, 1 ); <span class="comment">// unknown 1 - y</span></div>
<div class="line">        bc.addCondition(boundary::east, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, 0, 0, <span class="keyword">false</span>, 2 ); <span class="comment">// unknown 2 - z</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Surface forces</span></div>
<div class="line">        tmp &lt;&lt; 0, 0, -90;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>For the other test cases, please look at the file.</p>
<p>In the following snippet, the assembler is defined. Here, we can see that the <a class="el" href="classgismo_1_1gsExprAssembler.html">gsExprAssembler</a> is defined, typedefinitions for geometry map, variables, spaces and solutions are defined. Furthermore, the integration elements (quadrature points) are set according to the basis and an expression evaluator is constructed. Note that the <a class="el" href="classgismo_1_1gsExprAssembler.html#a18c842a314ce82703ab0b7132a32655c">gsExprAssembler::getSpace()</a> function is called with the second argument being the dimension of he space. Furthermore, for the parameters and materials, variables are defined. Lastly, note the definition of the <code>m2</code> object. This is a matrix with [1,1,2] on the diagonal because all the components (stresses, strains and their variations) are defined in Voight-notation.</p>
<div class="fragment"><div class="line">    gsExprAssembler&lt;&gt; A(1,1);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#a16c60fa6666b6a61c747b016c385a4e2">gsExprAssembler&lt;&gt;::geometryMap</a> geometryMap;</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#ae06340b104d0849a61073ea57edbf46c">gsExprAssembler&lt;&gt;::space</a>       space;</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#aa2c9456b2c52d7b912894815a3c593da">gsExprAssembler&lt;&gt;::solution</a>    solution;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Elements used for numerical integration</span></div>
<div class="line">    A.setIntegrationElements(dbasis);</div>
<div class="line">    gsExprEvaluator&lt;&gt; ev(A);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the geometry map</span></div>
<div class="line">    geometryMap G = A.getMap(mp); <span class="comment">// the last map counts</span></div>
<div class="line">    geometryMap defG = A.getMap(mp_def);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the discretization space</span></div>
<div class="line">    space u = A.getSpace(dbasis, 3);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Solution vector and solution variable</span></div>
<div class="line">    gsMatrix&lt;&gt; random;</div>
<div class="line">    solution u_sol = A.getSolution(u,random);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// gsFunctionExpr&lt;&gt; materialMat(&quot;1&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;,&quot;1&quot;,&quot;0&quot;,&quot;0&quot;,&quot;0&quot;,&quot;1&quot;,3);</span></div>
<div class="line">    gsFunctionExpr&lt;&gt; E(<a class="code hl_function" href="group__Utils.html#ga44d2df1e1ffdb68edf7f80158fd5be22">util::to_string</a>(E_modulus),3);</div>
<div class="line">    gsFunctionExpr&lt;&gt; nu(<a class="code hl_function" href="group__Utils.html#ga44d2df1e1ffdb68edf7f80158fd5be22">util::to_string</a>(PoissonRatio),3);</div>
<div class="line">    gsMaterialMatrix&lt;real_t&gt; materialMat(mp, E, nu);</div>
<div class="line">    <span class="keyword">auto</span> mm = A.getCoeff(materialMat); <span class="comment">// evaluates in the parametric domain, but the class transforms E and nu to physical</span></div>
<div class="line"> </div>
<div class="line">    gsFunctionExpr&lt;&gt; t(<a class="code hl_function" href="group__Utils.html#ga44d2df1e1ffdb68edf7f80158fd5be22">util::to_string</a>(thickness), 3);</div>
<div class="line">    <span class="keyword">auto</span> tt = A.getCoeff(t, G); <span class="comment">// evaluates in the physical domain</span></div>
<div class="line"> </div>
<div class="line">    gsFunctionExpr&lt;&gt; mult2t(<span class="stringliteral">&quot;1&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;1&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>,3);</div>
<div class="line">    <span class="keyword">auto</span> m2 = A.getCoeff(mult2t, G); <span class="comment">// evaluates in the physical domain</span></div>
<div class="line"> </div>
<div class="line">    gsConstantFunction&lt;&gt; force(tmp,3);</div>
<div class="line">    <span class="keyword">auto</span> ff = A.getCoeff(force,G); <span class="comment">// evaluates in the physical domain</span></div>
<div class="line"> </div>
<div class="line">    gsSparseSolver&lt;&gt;::CGDiagonal solver;</div>
<div class="line"> </div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_a16c60fa6666b6a61c747b016c385a4e2"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#a16c60fa6666b6a61c747b016c385a4e2">gismo::gsExprAssembler::geometryMap</a></div><div class="ttdeci">gsExprHelper&lt; T &gt;::geometryMap geometryMap</div><div class="ttdoc">Geometry map type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:65</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_aa2c9456b2c52d7b912894815a3c593da"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#aa2c9456b2c52d7b912894815a3c593da">gismo::gsExprAssembler::solution</a></div><div class="ttdeci">expr::gsFeSolution&lt; T &gt; solution</div><div class="ttdoc">Solution type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:68</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_ae06340b104d0849a61073ea57edbf46c"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#ae06340b104d0849a61073ea57edbf46c">gismo::gsExprAssembler::space</a></div><div class="ttdeci">gsExprHelper&lt; T &gt;::space space</div><div class="ttdoc">Space type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:67</div></div>
<div class="ttc" id="agroup__Utils_html_ga44d2df1e1ffdb68edf7f80158fd5be22"><div class="ttname"><a href="group__Utils.html#ga44d2df1e1ffdb68edf7f80158fd5be22">gismo::util::to_string</a></div><div class="ttdeci">std::string to_string(const C &amp;value)</div><div class="ttdoc">Converts value to string, assuming &quot;operator&lt;&lt;&quot; defined on C.</div><div class="ttdef"><b>Definition</b> gsUtils.h:56</div></div>
</div><!-- fragment --><p>Next up is the assembly of the system. First, all the necessary tensors (here, vectors by the Voight-notation) are defined. Dimensionality of the space is automatically taken into account. First, the weak Dirichlet and clamped boundary conditions are assembled according to the results of [5]. Then, the <a class="el" href="classgismo_1_1gsExprAssembler.html#a9b43d1c2f55ba3e0e91710c16b72e66d">gsExprAssembler::assemble()</a> function is called which assembles the linear system.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the system</span></div>
<div class="line">    u.setup(bc, dirichlet::interpolation, 0);</div>
<div class="line"> </div>
<div class="line">    A.initSystem();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Number of degrees of freedom: &quot;</span>&lt;&lt; A.numDofs() &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>&lt;&lt;std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">        We provide the following functions:</span></div>
<div class="line"><span class="comment">            E_m         membrane strain tensor.</span></div>
<div class="line"><span class="comment">            E_m_der     first variation of E_m.</span></div>
<div class="line"><span class="comment">            E_m_der2    second variation of E_m MULTIPLIED BY S_m.</span></div>
<div class="line"><span class="comment">            E_f         flexural strain tensor.</span></div>
<div class="line"><span class="comment">            E_f_der     second variation of E_f.</span></div>
<div class="line"><span class="comment">            E_f_der2    second variation of E_f MULTIPLIED BY S_f.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">        Where:</span></div>
<div class="line"><span class="comment">            G       the undeformed geometry,</span></div>
<div class="line"><span class="comment">            defG    the deformed geometry,</span></div>
<div class="line"><span class="comment">            mm      the material matrix,</span></div>
<div class="line"><span class="comment">            m2      an auxillary matrix to multiply the last row of a tensor with 2</span></div>
<div class="line"><span class="comment">    **/</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Membrane components</span></div>
<div class="line">    <span class="keyword">auto</span> E_m = 0.5 * ( flat(jac(defG).tr()*jac(defG)) - flat(jac(G).tr()* jac(G)) ) ;</div>
<div class="line">    <span class="keyword">auto</span> S_m = E_m * reshape(mm,3,3);</div>
<div class="line">    <span class="keyword">auto</span> N   = tt.val() * S_m;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> E_m_der = flat( jac(defG).tr() * jac(u) ) ;</div>
<div class="line">    <span class="keyword">auto</span> S_m_der = E_m_der * reshape(mm,3,3);</div>
<div class="line">    <span class="keyword">auto</span> N_der   = tt.val() * S_m_der;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> E_m_der2 = flatdot( jac(u),jac(u).tr(), N );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Flexural components</span></div>
<div class="line">    <span class="keyword">auto</span> E_f = ( deriv2(G,sn(G).normalized().tr()) - deriv2(defG,sn(defG).normalized().tr()) ) * reshape(m2,3,3) ;</div>
<div class="line">    <span class="keyword">auto</span> S_f = E_f * reshape(mm,3,3);</div>
<div class="line">    <span class="keyword">auto</span> M   = tt.val() * tt.val() * tt.val() / 12.0 * S_f;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> E_f_der = -( deriv2(u,sn(defG).normalized().tr() ) + deriv2(defG,var1(u,defG) ) ) * reshape(m2,3,3);</div>
<div class="line">    <span class="keyword">auto</span> S_f_der = E_f_der * reshape(mm,3,3);</div>
<div class="line">    <span class="keyword">auto</span> M_der   = tt.val() * tt.val() * tt.val() / 12.0 * S_f_der;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> E_f_der2 = - (flatdot2( deriv2(u), var1(u,defG).tr(), M  ).symmetrize() + var2(u,u,defG, M ));</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> F        = ff;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// For Neumann (same for Dirichlet/Nitsche) conditions</span></div>
<div class="line">    <span class="keyword">auto</span> g_N = A.getBdrFunction(G);</div>
<div class="line">    <span class="comment">// auto g_N = ff;</span></div>
<div class="line"> </div>
<div class="line">    real_t alpha_d = 1e3;</div>
<div class="line">    A.assembleBdr</div>
<div class="line">    (</div>
<div class="line">        bc.get(<span class="stringliteral">&quot;Weak Dirichlet&quot;</span>)</div>
<div class="line">        ,</div>
<div class="line">        alpha_d * u * u.tr()</div>
<div class="line">        ,</div>
<div class="line">        alpha_d * (u * (defG - G) - u * (g_N) )</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// For Neumann conditions</span></div>
<div class="line">    A.assembleBdr(bc.get(<span class="stringliteral">&quot;Neumann&quot;</span>), u * g_N * tv(G).norm() );</div>
<div class="line"> </div>
<div class="line">    A.assemble(</div>
<div class="line">        (N_der * (E_m_der).tr() + M_der * (E_f_der).tr() ) * meas(G)</div>
<div class="line">        ,</div>
<div class="line">        u * F  * meas(G) + pressure * u * sn(defG).normalized() * meas(G)</div>
<div class="line">        );</div>
<div class="line"> </div>
</div><!-- fragment --><p>The linear system can now be solved according tot the following. ALso, the deformed multipatch is constructed by adding the displacements - the solution to the system - to the original multipatch. Note that the solution vector contains the displacements of the control points of the original geometry. The solution object and the <a class="el" href="classgismo_1_1gsExprEvaluator.html">gsExprEvaluator</a> are used for plotting. Also the stresses are evaluated at a point.</p>
<div class="fragment"><div class="line">    <span class="comment">// solve system</span></div>
<div class="line">    solver.compute( A.matrix() );</div>
<div class="line">    gsMatrix&lt;&gt; solVector = solver.solve(A.rhs());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// update deformed patch</span></div>
<div class="line">    gsMatrix&lt;&gt; cc;</div>
<div class="line"> </div>
<div class="line">    u_sol.setSolutionVector(solVector);</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> k =0; k!=mp_def.nPatches(); ++k) <span class="comment">// Deform the geometry</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// // extract deformed geometry</span></div>
<div class="line">        u_sol.extract(cc, k);</div>
<div class="line">        mp_def.patch(k).coefs() += cc;  <span class="comment">// defG points to mp_def, therefore updated</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gsMatrix&lt;&gt; result;</div>
<div class="line">    u_sol.extractFull(result);</div>
<div class="line"> </div>
</div><!-- fragment --><p>Now it is time for the nonlinear system assembly. The variational form depends on the deformed geometry which is the current geometry plus the computed displacements in the linear solve. In each iteration, the nonlinear variational form is assembled to a system of equations.</p>
<div class="fragment"><div class="line">    real_t residual = A.rhs().norm();</div>
<div class="line">    real_t residual0 = residual;</div>
<div class="line">    real_t residualOld = residual;</div>
<div class="line">    gsMatrix&lt;&gt; updateVector = solVector;</div>
<div class="line">    <span class="keywordflow">if</span> (nonlinear)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> itMax = 25;</div>
<div class="line">        real_t tol = 1e-8;</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> it = 0; it != itMax; ++it)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">            A.initSystem();</div>
<div class="line">            <span class="comment">// assemble system</span></div>
<div class="line">            A.assemble(</div>
<div class="line">                (</div>
<div class="line">                  N_der * E_m_der.tr()</div>
<div class="line">                    +</div>
<div class="line">                  E_m_der2</div>
<div class="line">                    +</div>
<div class="line">                  M_der * E_f_der.tr()</div>
<div class="line">                    +</div>
<div class="line">                  E_f_der2</div>
<div class="line">                  ) * meas(G)</div>
<div class="line">                    -</div>
<div class="line">                  pressure * u * var1(u,defG) .tr() * meas(G)</div>
<div class="line">                , u * F * meas(G) + pressure * u * sn(defG).normalized() * meas(G) - ( ( N * E_m_der.tr() + M * E_f_der.tr() ) * meas(G) ).tr()</div>
<div class="line">                );</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Neumann term</span></div>
<div class="line">            A.assembleBdr(bc.get(<span class="stringliteral">&quot;Neumann&quot;</span>), u * g_N * tv(G).norm() );</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Weak Dirichlet term</span></div>
<div class="line">            A.assembleBdr</div>
<div class="line">            (</div>
<div class="line">                bc.get(<span class="stringliteral">&quot;Weak Dirichlet&quot;</span>)</div>
<div class="line">                ,</div>
<div class="line">                alpha_d * u * u.tr()</div>
<div class="line">                ,</div>
<div class="line">                -alpha_d * (u * (defG - G) - u * (g_N) )</div>
<div class="line">            );</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// solve system</span></div>
<div class="line">            solver.compute( A.matrix() );</div>
<div class="line">            updateVector = solver.solve(A.rhs()); <span class="comment">// this is the UPDATE</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">            solVector += updateVector;</div>
<div class="line">            residual = A.rhs().norm();</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Iteration: &quot;</span>&lt;&lt; it</div>
<div class="line">                   &lt;&lt;<span class="stringliteral">&quot;, residue: &quot;</span>&lt;&lt; residual</div>
<div class="line">                   &lt;&lt;<span class="stringliteral">&quot;, update norm: &quot;</span>&lt;&lt;updateVector.norm()</div>
<div class="line">                   &lt;&lt;<span class="stringliteral">&quot;, log(Ri/R0): &quot;</span>&lt;&lt; math::log10(residualOld/residual0)</div>
<div class="line">                   &lt;&lt;<span class="stringliteral">&quot;, log(Ri+1/R0): &quot;</span>&lt;&lt; math::log10(residual/residual0)</div>
<div class="line">                   &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">            residualOld = residual;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// update deformed patch</span></div>
<div class="line">            u_sol.setSolutionVector(updateVector);</div>
<div class="line">            <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> k =0; k!=mp_def.nPatches(); ++k) <span class="comment">// Deform the geometry</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// // extract deformed geometry</span></div>
<div class="line">                u_sol.extract(cc, k);</div>
<div class="line">                mp_def.patch(k).coefs() += cc;  <span class="comment">// defG points to mp_def, therefore updated</span></div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (residual &lt; tol)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p>When the solution to the nonlinear problem is known, the solution is constructed and the deformations are evaluated. The deformation is simply the difference between the deformed and the original geometries.</p>
<div class="fragment"><div class="line">    u_sol.setSolutionVector(solVector);</div>
<div class="line">    mp_def = mp;</div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> k =0; k!=mp.nPatches(); ++k) <span class="comment">// Deform the geometry</span></div>
<div class="line">    {</div>
<div class="line">        u_sol.extract(cc, k);</div>
<div class="line">        mp_def.patch(k).coefs() += cc;  <span class="comment">// defG points to mp_def, therefore updated</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    gsMultiPatch&lt;&gt; deformation = mp_def;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k != mp_def.nPatches(); ++k)</div>
<div class="line">        deformation.patch(k).coefs() -= mp.patch(k).coefs();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt;<span class="stringliteral">&quot;Maximum deformation coef: &quot;</span></div>
<div class="line">           &lt;&lt; deformation.patch(0).coefs().colwise().maxCoeff() &lt;&lt;<span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt;<span class="stringliteral">&quot;Minimum deformation coef: &quot;</span></div>
<div class="line">           &lt;&lt; deformation.patch(0).coefs().colwise().minCoeff() &lt;&lt;<span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt;<span class="stringliteral">&quot;Area (undeformed) = &quot;</span>&lt;&lt;ev.integral(meas(G))&lt;&lt;<span class="stringliteral">&quot;\tArea (undeformed) = &quot;</span>&lt;&lt;ev.integral(meas(defG))&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p>Lastly, the deformation can be evaluated on several points:</p>
<div class="fragment"><div class="line">    gsMatrix&lt;&gt; coords(2,1);</div>
<div class="line">    <span class="keywordflow">if</span> (testCase==1)</div>
<div class="line">      coords&lt;&lt;0,0;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (testCase==2)</div>
<div class="line">      coords&lt;&lt;0.5,0;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (testCase==3)</div>
<div class="line">      coords&lt;&lt;0,0;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (testCase==4)</div>
<div class="line">      coords&lt;&lt;1,1;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      coords&lt;&lt;0,0;</div>
<div class="line"> </div>
<div class="line">    gsMatrix&lt;&gt; res(3,1);</div>
<div class="line">    mp.patch(0).eval_into(coords,res);</div>
<div class="line">    real_t x=res.at(0);</div>
<div class="line">    real_t y=res.at(1);</div>
<div class="line">    real_t z=res.at(2);</div>
<div class="line"> </div>
<div class="line">    deformation.patch(0).eval_into(coords,res);</div>
<div class="line">    real_t ux=res.at(0);</div>
<div class="line">    real_t uy=res.at(1);</div>
<div class="line">    real_t uz=res.at(2);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Deformation on point (&quot;</span>&lt;&lt;x&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;y&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;z&lt;&lt;<span class="stringliteral">&quot;):\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;std::setprecision(20)&lt;&lt;<span class="stringliteral">&quot;(&quot;</span>&lt;&lt;ux&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;uy&lt;&lt;<span class="stringliteral">&quot;,&quot;</span>&lt;&lt;uz&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
</div><!-- fragment --><p>And the solution can be plotted in Paraview:</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (plot)</div>
<div class="line">    {</div>
<div class="line">        gsField&lt;&gt; solField(mp, deformation);</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Plotting in Paraview...\n&quot;</span>;</div>
<div class="line">        gsWriteParaview&lt;&gt;( solField, <span class="stringliteral">&quot;solution&quot;</span>, 1000, <span class="keyword">true</span>);</div>
<div class="line">        <span class="comment">// gsFileManager::open(&quot;solution.pvd&quot;);</span></div>
<div class="line">    }</div>
</div><!-- fragment --><h1><a class="anchor" id="References"></a>
References</h1>
<p>[1] J. Kiendl, K.-U. Bletzinger, J. Linhard, and R. Wchner, Isogeometric shell analysis with KirchhoffLove elements, Comput. Methods Appl. Mech. Eng., vol. 198, no. 4952, pp. 39023914, Nov. 2009.</p>
<p>[2] J. Kiendl, Isogeometric analysis and shape optimal design of shell structures, Technische Universitt Mnchen, 2011.</p>
<p>[3] A. Goyal, Isogeometric Shell Discretizations for Flexible Multibody Dynamics, Technische Universitt Kaiserslautern, 2015.</p>
<p>[4] H. M. Verhelst, Modelling Wrinkling Behaviour of Large Floating Thin Offshore Structures: An application of Isogeometric Structural Analysis for Post-Buckling Analyses, Delft University of Technology, 2019.</p>
<p>[5] A. J. Herrema, E. L. Johnson, D. Proserpio, M. C. H. Wu, J. Kiendl, and M.-C. Hsu, Penalty coupling of non-matching isogeometric KirchhoffLove shell patches with application to composite wind turbine blades, Comput. Methods Appl. Mech. Eng., vol. 346, pp. 810840, Apr. 2019.</p>
<h1><a class="anchor" id="Contact"></a>
Contact</h1>
<p>Author: Hugo Verhelst &ndash; <a href="#" onclick="location.href='mai'+'lto:'+'h.m'+'.v'+'erh'+'el'+'st@'+'tu'+'del'+'ft'+'.nl'; return false;">h.m.v<span class="obfuscator">.nosp@m.</span>erhe<span class="obfuscator">.nosp@m.</span>lst@t<span class="obfuscator">.nosp@m.</span>udel<span class="obfuscator">.nosp@m.</span>ft.nl</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jan 20 2025 09:35:27 for G+Smo by Doxygen v1.9.8 </li>
  </ul>
</div>
<!-- Piwik --> 
<!--
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.sylphide-consulting.com/piwik/" : "http://stats.sylphide-consulting.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 20);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.sylphide-consulting.com/piwik/piwik.php?idsite=20" style="border:0" alt="" /></p></noscript>
-->
<!-- End Piwik Tracking Code -->
</body>
</html>
