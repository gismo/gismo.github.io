<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>G+Smo: thbSplineBasis_example.cpp</title>
<link href="gismodoxy_tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://people.ricam.oeaw.ac.at/gismo/mj/MathJax.js"></script>
<link href="doxygen.css"   rel="stylesheet" type="text/css" />
<link href="gismodoxy.css" rel="stylesheet" type="text/css">
<!--  -->
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gslogo-doxy.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="index.html"><font style="font-variant:small-caps;">G+S</font><font style="font-variant:small-caps;"
															    color="#000000">mo</font></a>
   &#160;<span id="projectnumber">25.01.0</span>
   </div>
   <div id="projectbrief">Geometry + Simulation Modules</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('thbSplineBasis_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">thbSplineBasis_example.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial provides a basic motivation for <b>truncated hierarchical B-splines (THB-splines)</b> and a brief introduction to some basic features of <a class="el" href="classgismo_1_1gsTHBSplineBasis.html" title="Truncated hierarchical B-spline basis.">gsTHBSplineBasis</a>.<br  />
 See also <a class="el" href="basis_example.html">basis_example.cpp</a> and <a class="el" href="bSplineBasis_example.html">bSplineBasis_example.cpp</a>.</p>
<p>More details on the hierarchical splines can be found in <a class="el" href="adaptRefinementThb_example.html">adaptRefinementThb_example.cpp</a> as well as in the <a class="el" href="group__HSplines.html">Hierarchical splines module</a> description.</p>
<h1><a class="anchor" id="sIntro"></a>
Introduction</h1>
<p>Two simple examples are provided for illustrating the construction of a THB-spline basis. The formal definition is given only for the sake of completeness (see <a class="el" href="thbSplineBasis_example.html#ssFormalDef">Formal definition</a>), see the <a class="el" href="thbSplineBasis_example.html#sReferences">References</a> for further details.</p>
<h2><a class="anchor" id="s1d"></a>
1D-example</h2>
<p>For illustration, consider a 1D-example.<br  />
 We start with two sets of B-Spline basis functions of degree 2:</p>
<p>Level 0, the "coarse" ones, with knot vector \( s^0 = (0,\ 0,\ 0,\ 1/8,\ 2/8,\ ... 7/8,\ 1,\ 1,\ 1)\)</p>
<p>Level 1, the "fine" ones, with knot vector \( s^1 = (0,\ 0,\ 0,\ 1/16,\ 2/16,\ ... 15/16,\ 1,\ 1,\ 1)\)</p>
<p>These two bases are illustrated here (shown in different colours and thickness only for better visibility): </p><div class="image">
<img src="tutTHB_1d_B0.png" alt=""/>
<div class="caption">
B-splines of level 0</div></div>
<div class="image">
<img src="tutTHB_1d_B1.png" alt=""/>
<div class="caption">
B-splines of level 1</div></div>
<p>The parameter domain is referred to as \( \Omega^0 \). The green area in the pictures indicates \( \Omega^1 \subset \Omega^0 \), i.e., the area where we want finer basis functions.</p>
<p>A straightforward way of doing so: Take all fine functions \( \beta^1_j \) where \( \mathrm{supp} \beta^1_j \subset \Omega^1 \),</p>
<div class="image">
<img src="tutTHB_1d_B1act.png" alt=""/>
<div class="caption">
Active B-splines of level 1</div></div>
<p>...and only those coarse functions \( \beta^0_i \) where \( \mathrm{supp} \beta^0_i \subset \Omega^0 \land \mathrm{supp} \beta^0_i \not \subset \Omega^1 \)</p>
<div class="image">
<img src="tutTHB_1d_B0sel.png" alt=""/>
<div class="caption">
Active B-splines of level 0</div></div>
<h3><a class="anchor" id="sssHB"></a>
HB-splines</h3>
<p>By taking the union of these two sets of functions, we obtain the hierarchical B-spline basis (HB-splines) of level 1:</p>
<div class="image">
<img src="tutTHB_1d_H1.png" alt=""/>
<div class="caption">
HB-splines</div></div>
<p>With this basis, however, the partition-of-unity property is lost. Also, there can be large overlaps of the supports of the basis functions.</p>
<h3><a class="anchor" id="sssTHB"></a>
THB-splines</h3>
<p>Instead of just using the coarse functions as they are, the coarse functions are truncated (see <a class="el" href="thbSplineBasis_example.html#sReferences">References</a> at the bottom for details). This results in the THB-spline basis of level 1:</p>
<div class="image">
<img src="tutTHB_1d_T1.png" alt=""/>
<div class="caption">
THB-splines</div></div>
<p>THB-splines again have the partition-of-unity property and support overlaps are reduced.</p>
<p>Note that HB-splines and THB-splines span the same function space.</p>
<h2><a class="anchor" id="s2d"></a>
2D-example</h2>
<p>Similar to the 1D-case above, consider a coarse and a fine mesh, as displayed on the left, and right, respectively. The corresponding tensor-product B-spline bases of degree 2 are displayed in the picture below. The green area again indicates the area where we want fine basis funcitons.</p>
<div class="image">
<img src="tutTHB_2d_m0_m1.png" alt=""/>
<div class="caption">
Meshes of levels 0 and 1, green are to be refined to level 1.</div></div>
<p> <br  />
 </p><div class="image">
<img src="tutTHB_2d_B0_B1.png" alt=""/>
<div class="caption">
Tensor-product B-spline bases of levels 0 and 1.</div></div>
<p> <br  />
 As in the 1D-case, we select<br  />
 the coarse functions \( \beta^0_i \) where \( \mathrm{supp} \beta^0_i \subset \Omega^0 \land \mathrm{supp} \beta^0_i \not \subset \Omega^1 \), and we truncate them (displayed on the left)<br  />
 and the fine functions \( \beta^1_j \) where \( \mathrm{supp} \beta^1_j \subset \Omega^1 \) (displayed on the right):</p>
<div class="image">
<img src="tutTHB_2d_B0_B1_acts.png" alt=""/>
<div class="caption">
Active basis functions of levels 0 (already truncated) and of level 1.</div></div>
<p> <br  />
 The union of these functions is the THB-spline basis:</p>
<div class="image">
<img src="tutTHB_2d_Tm1_T1.png" alt=""/>
<div class="caption">
Locally refined mesh and corresponding THB-spline basis.</div></div>
<p> <br  />
</p>
<h2><a class="anchor" id="ssFormalDef"></a>
Formal definition</h2>
<p>Just for the sake of completeness, a brief formal definition is provided, without going into any details. See <a class="el" href="thbSplineBasis_example.html#sReferences">References</a> at the bottom for details</p>
<h3><a class="anchor" id="sssTrunc"></a>
Truncation operation</h3>
<p>Let \( B^{\ell-1} \) denote the (tensor-product) B-spline basis of level \(\ell - 1 \). Let a function \( \tau \in \mathrm{span} B^{\ell-1} \) be represented in terms of \( B^{\ell} \) by \( \tau = \sum_{\beta^{\ell} \in B^{\ell} } c_\beta \beta^{\ell} \). The truncation of \( \tau \) is given by \( \mathrm{trunc}^{\ell} \tau = \sum_{\beta^{\ell} \in B^{\ell},\ \mathrm{supp} \beta^{\ell} \not \subseteq \Omega^{\ell} } c_\beta \beta^{\ell} \)</p>
<h3><a class="anchor" id="sssTHBdef"></a>
THB-spline basis</h3>
<p>\( T^0 = B^0 \)<br  />
 \( T^{\ell} =  T_A^{\ell} \cup T_B^{\ell}\), where<br  />
 \( \quad T_A^{\ell} = \{ \mathrm{trunc}^{\ell} \tau:\ \tau \in T^{\ell-1} \land \mathrm{supp} \tau \not \subseteq \Omega^{\ell} \} \) <br  />
 \( \quad T_B^{\ell} = \{ \beta^\ell \in B^{\ell}:\ \mathrm{supp} \beta^\ell \subseteq \Omega^{\ell} \} \)<br  />
 \( T = T^N \)</p>
<h1><a class="anchor" id="sConst"></a>
Constructing a THB-spline-basis</h1>
<p>Remark: <a class="el" href="classgismo_1_1gsTHBSplineBasis.html" title="Truncated hierarchical B-spline basis.">gsTHBSplineBasis</a> and <a class="el" href="classgismo_1_1gsHBSplineBasis.html" title="A hierarchical B-spline basis of parametric dimension d.">gsHBSplineBasis</a> are derived from <a class="el" href="classgismo_1_1gsHTensorBasis.html" title="Class representing a (scalar) hierarchical tensor basis of functions .">gsHTensorBasis</a></p>
<h2><a class="anchor" id="ssConstTens"></a>
From tensor-basis</h2>
<p>Constructor using a <a class="el" href="classgismo_1_1gsTensorBSplineBasis.html" title="A tensor product B-spline basis.">gsTensorBSplineBasis</a> as argument.</p>
<div class="fragment"><div class="line">    <span class="comment">// Set up and construct a knot vector...</span></div>
<div class="line">    real_t a = 0;                   <span class="comment">// starting knot</span></div>
<div class="line">    real_t b = 1;                   <span class="comment">// ending knot</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> interior = 3;          <span class="comment">// number of interior knots</span></div>
<div class="line">    <span class="keywordtype">int</span>      degree = 2;</div>
<div class="line">    <span class="keywordtype">unsigned</span> multEnd = degree + 1;  <span class="comment">// multiplicity at the two end knots</span></div>
<div class="line">    gsKnotVector&lt;&gt; kv(a, b, interior, multEnd);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...a 2D-tensor-B-spline basis with this knot vector...</span></div>
<div class="line">    gsTensorBSplineBasis&lt;2,real_t&gt; tens( kv, kv );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...and a 2D-THB-spline basis out of the tensor-B-spline basis.</span></div>
<div class="line">    gsTHBSplineBasis&lt;2,real_t&gt; thb( tens );</div>
</div><!-- fragment --><h2><a class="anchor" id="ssConstXml"></a>
From xml</h2>
<p>Example for a THB-spline basis of degree 2: </p><pre class="fragment">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xml&gt;
 &lt;Basis type="THBSplineBasis2" levels="6"&gt;
  &lt;Basis type="TensorBSplineBasis2"&gt;
   &lt;Basis type="BSplineBasis" index="0"&gt;
    &lt;KnotVector degree="2"&gt;0 0 0 1 1 1 &lt;/KnotVector&gt;
   &lt;/Basis&gt;
   &lt;Basis type="BSplineBasis" index="1"&gt;
    &lt;KnotVector degree="2"&gt;0 0 0 1 1 1 &lt;/KnotVector&gt;
   &lt;/Basis&gt;
  &lt;/Basis&gt;
 &lt;/Basis&gt;
&lt;/xml&gt;
</pre><p> The tensor-product B-spline basis in the "THBSplineBasis2" defines the basis of level 0.</p>
<h1><a class="anchor" id="sRef"></a>
Refinement</h1>
<div class="image">
<img src="tutTHB_2d_m0_m1.png" alt=""/>
<div class="caption">
Meshes of levels 0 and 1, green are to be refined to level 1.</div></div>
<h2><a class="anchor" id="sRefElts"></a>
using refineElements( std::vector )</h2>
<p>See <a class="el" href="classgismo_1_1gsHTensorBasis.html#ae9fe38b5346fe57a6d0c859218323bcc" title="Insert the given boxes into the quadtree.">gsHTensorBasis::refineElements()</a>. The argument is a std::vector&lt;unsigned&gt; containing a sequence of <em>n*(1+2*d)</em> unsigned. Each (1+2*d)-tuple contains the following information:</p><ul>
<li>the the level that you want to refine to</li>
<li>the lower corner in unique knot span indices of the new level</li>
<li>the upper corner in unique knot span indices of the new level</li>
</ul>
<p>The green are marked in the 2D-example above has lower corner (2,0) and upper corner (8,4) in unique knot indices at level 1. We can refine this area as follows:</p>
<div class="fragment"><div class="line">    std::vector&lt;index_t&gt; box;</div>
<div class="line">    box.push_back( 1 );</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 0 );</div>
<div class="line">    box.push_back( 8 );</div>
<div class="line">    box.push_back( 4 );</div>
<div class="line"> </div>
<div class="line">    thb.refineElements(box);</div>
</div><!-- fragment --><p>This method is the recommended one, since the corners of the refinement areas are specified by unsigned integers, which is numerically stable. Also, since the level is specified explicitly, double calls by mistake will not result in double refinement.</p>
<h2><a class="anchor" id="sRefBox"></a>
by the "&lt;box&gt;" tag in the xml</h2>
<p>One can also specify different levels of refinement already in the xml-file, using the "box"-tag: </p><pre class="fragment">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xml&gt;
 &lt;Basis type="THBSplineBasis2" levels="6"&gt;   
  &lt;Basis type="TensorBSplineBasis2"&gt;         
   &lt;Basis type="BSplineBasis" index="0"&gt;
    &lt;KnotVector degree="2"&gt;0 0 0 1 1 1 &lt;/KnotVector&gt;
   &lt;/Basis&gt;
   &lt;Basis type="BSplineBasis" index="1"&gt;
    &lt;KnotVector degree="2"&gt;0 0 0 1 1 1 &lt;/KnotVector&gt;
   &lt;/Basis&gt;
  &lt;/Basis&gt;
 &lt;box level="1"&gt;2 0 8 4&lt;/box&gt;
 &lt;/Basis&gt;
&lt;/xml&gt;
</pre><h2><a class="anchor" id="sRefMatrix"></a>
using refine( gsMatrix )</h2>
<p>See <a class="el" href="classgismo_1_1gsHTensorBasis.html#a3d23d10ae01570be0a326d9478868228" title="Refine the basis to levels and in the areas defined by boxes with an extension.">gsHTensorBasis::refine()</a>. The argument is a <a class="el" href="classgismo_1_1gsMatrix.html" title="A matrix with arbitrary coefficient type and fixed or dynamic size.">gsMatrix</a> of size <em>d x (2*n)</em>. Two columns represent the coordinates of the lower and the upper corner, respectively, of the area to be refined. In our example, the area to be refined can be written as </p><pre class="fragment">gsMatrix&lt;real_t&gt; boxM(2,2);
boxM(0,0) = 0.25;
boxM(1,0) = 0.0;

boxM(0,1) = 1.0;
boxM(1,1) = 0.5;

thb.refine( boxM );
</pre><p>This method refines all elements overlapping the specified box.</p>
<p><b>Warning!</b><br  />
 This method does not specify which level should be refined to. If parts overlap, areas might get refined twice.<br  />
 This refinement function uses numerical values, which could cause problems, especially when the coordinates coincide with knots.</p>
<h1><a class="anchor" id="sOps"></a>
Basic operations</h1>
<h2><a class="anchor" id="sOps0"></a>
"standard" operations</h2>
<p>Just like with the other bases. For example, displaying information via std::cout,<br  />
</p>
<div class="fragment"><div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;this basis is:\n&quot;</span> &lt;&lt; thb &lt;&lt; std::endl;</div>
<div class="ttc" id="agsDebug_8h_html_af6177e1e282640c3cb9175565f84a432"><div class="ttname"><a href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a></div><div class="ttdeci">#define gsInfo</div><div class="ttdef"><b>Definition</b> gsDebug.h:43</div></div>
</div><!-- fragment --><p>will return the following:</p>
<pre class="fragment">This basis is:
Truncated basis of dimension 2,
levels=2, size=54, tree_nodes=5).
Domain: [0 0]..[1 1].
Size per level: 30 24 
</pre><p>The last line refers to the number of basis functions on the respective levels.</p>
<p>Other functions such as <a class="el" href="classgismo_1_1gsHTensorBasis.html#a7efde05f969b28f4ce7c984352708db7" title="Returns the indices of active basis functions at points u, as a list of indices, in result....">gsHTensorBasis::active_into()</a>,<br  />
 <a class="el" href="classgismo_1_1gsBasis.html#a776b01a805ce104b72285270c40abb72" title="Evaluates nonzero basis functions at point u into result.">gsHTensorBasis::eval_into()</a>,<br  />
 <a class="el" href="classgismo_1_1gsBasis.html#abe26fb7602b6c87c1b5740c5f4463f99" title="Evaluates the first partial derivatives of the nonzero basis function.">gsHTensorBasis::deriv_into()</a>, and also <br  />
 gsHTensorBasis::uniformRefine() work as usual.</p>
<p>Example: </p><div class="fragment"><div class="line">    gsMatrix&lt;real_t&gt; u(2,3);</div>
<div class="line">    u(0,0) = 0.95;</div>
<div class="line">    u(1,0) = 0.05;</div>
<div class="line"> </div>
<div class="line">    u(0,1) = 0.95;</div>
<div class="line">    u(1,1) = 0.3;</div>
<div class="line"> </div>
<div class="line">    u(0,2) = 0.6;</div>
<div class="line">    u(1,2) = 0.9;</div>
<div class="line"> </div>
<div class="line">    gsMatrix&lt;index_t&gt; resActives;</div>
<div class="line">    gsMatrix&lt;real_t&gt;   resEvals;</div>
<div class="line"> </div>
<div class="line">    thb.active_into( u, resActives);</div>
<div class="line">    thb.eval_into(   u, resEvals);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;active functions: \n&quot;</span> &lt;&lt; resActives &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;their values:     \n&quot;</span> &lt;&lt; resEvals   &lt;&lt; std::endl;</div>
</div><!-- fragment --><div class="image">
<img src="tutTHB_2d_Tm1_evalPts.png" alt=""/>
<div class="caption">
evaluation points</div></div>
<p><br  />
</p>
<pre class="fragment">active functions: 
 9  9 14
10 10 15
11 11 16
33 15 20
34 16 21
35 17 22
39 45 26
40 46 27
41 47 28
45 51  0
46 52  0
47 53  0
their values:     
     0 0.0012 0.0144
     0 0.0204 0.0592
     0 0.0384 0.0064
0.0288 0.0004 0.1008
0.2016 0.0068 0.4144
0.1296 0.0128 0.0448
0.0448 0.0144 0.0648
0.3136 0.1008 0.2664
0.2016 0.0648 0.0288
0.0064 0.0592      0
0.0448 0.4144      0
0.0288 0.2664      0
</pre><p><b>Note:</b> </p><ul>
<li>
<p class="startli">The basis functions are numbered firstly by level (starting with level 0), and then by the tensor-index of the respective level (see <a class="el" href="thbSplineBasis_example.html#sOpsHIndexing">Indexing / numbering of basis functions</a>).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="classgismo_1_1gsHTensorBasis.html#a7efde05f969b28f4ce7c984352708db7" title="Returns the indices of active basis functions at points u, as a list of indices, in result....">gsHTensorBasis::active_into()</a> does not account for functions which are truncated to zero (i.e., it will return the same result for <a class="el" href="classgismo_1_1gsHBSplineBasis.html" title="A hierarchical B-spline basis of parametric dimension d.">gsHBSplineBasis</a> and <a class="el" href="classgismo_1_1gsTHBSplineBasis.html" title="Truncated hierarchical B-spline basis.">gsTHBSplineBasis</a>). Functions which are truncated to zero will be evaluated as (exactly) zero.</p>
<p class="endli"></p>
</li>
<li>
The numbers of active functions at the two evaluation points may different. Any shorter columns will be filled with (exact) zeros. </li>
</ul>
<h2><a class="anchor" id="sOpsHBasis"></a>
gsHTensorBasis - specific</h2>
<p>Some additional functions are specific to <a class="el" href="classgismo_1_1gsHTensorBasis.html" title="Class representing a (scalar) hierarchical tensor basis of functions .">gsHTensorBasis</a>.</p>
<h3><a class="anchor" id="sOpsHIndexing"></a>
Indexing / numbering of basis functions</h3>
<p>The basis functions are numbered firstly by level (starting with level 0), and then by the tensor-index of the respective level.<br  />
 The index in the numbering of the whole THB-spline basis (in our example, the numbering from 0 to 53), is referred to as <em>global index</em> or <em>hierarchical index</em>.<br  />
 The index that a certain function has within the tensor-product B-spline basis of the respective level is referred to as <em>flat tensor index</em> ("flat" in the sense that no <em>d</em>-tupels are used, but the tensor-product basis functions already have a "single-digit" index).</p>
<p>To get the flat index and the level of a certain basis function, use <a class="el" href="classgismo_1_1gsHTensorBasis.html#a021a64b733300d4c91331f76fb02269c" title="Returns the tensor index of the function indexed i (in continued indices).">gsHTensorBasis::flatTensorIndexOf()</a> and <a class="el" href="classgismo_1_1gsHTensorBasis.html#a9a5bf678a4945652770e0eddba9e861b" title="Returns the level of the function indexed i (in continued indices)">gsHTensorBasis::levelOf()</a>.</p>
<div class="fragment"><div class="line">    std::vector&lt;unsigned&gt; tmpFlatIndices;</div>
<div class="line">    std::vector&lt;int&gt;      tmpLevels;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;transform indices\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;global/hier.index  -&gt;  flat tensor index (on level)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 27; i &lt;= 35; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// print computed indices/levels</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; i;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  -&gt;  &quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; thb.flatTensorIndexOf(i);</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  ( &quot;</span> &lt;&lt; thb.levelOf(i) &lt;&lt; <span class="stringliteral">&quot; )&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// store indices/levels for reverse transformation later</span></div>
<div class="line">        tmpFlatIndices.push_back( thb.flatTensorIndexOf(i) );</div>
<div class="line">        tmpLevels.push_back(  thb.levelOf(i) );</div>
<div class="line">    }</div>
</div><!-- fragment --><p>will, in our example, print</p>
<pre class="fragment">transform indices
global/hier.index  -&gt;  flat tensor index (on level)
27  -&gt;  33  ( 0 )
28  -&gt;  34  ( 0 )
29  -&gt;  35  ( 0 )
30  -&gt;  4  ( 1 )
31  -&gt;  5  ( 1 )
32  -&gt;  6  ( 1 )
33  -&gt;  7  ( 1 )
34  -&gt;  8  ( 1 )
35  -&gt;  9  ( 1 )
</pre><p>To compute the global/hierarchical index from a given flat index and a given level, use <a class="el" href="classgismo_1_1gsHTensorBasis.html#a9ec704088790780be4662296ec07e788" title="takes a flat tensor index of the bspline basis of level and gives back the hierachical index....">gsHTensorBasis::flatTensorIndexToHierachicalIndex()</a>.</p>
<div class="fragment"><div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;reverse index transformation\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;flat tensor index (on level)  -&gt;  global/hier.index&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0; i &lt; tmpLevels.size(); i++ )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// print global/hierarchical indices</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; tmpFlatIndices[i] &lt;&lt; <span class="stringliteral">&quot;  ( &quot;</span> &lt;&lt; tmpLevels[i] &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  -&gt;  &quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; thb.flatTensorIndexToHierachicalIndex( tmpFlatIndices[i], tmpLevels[i] ) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
</div><!-- fragment --><p>will, in our example, print</p>
<pre class="fragment">reverse index transformation
flat tensor index (on level)  -&gt;  global/hier.index
33  ( 0 )  -&gt;  27
34  ( 0 )  -&gt;  28
35  ( 0 )  -&gt;  29
4  ( 1 )  -&gt;  30
5  ( 1 )  -&gt;  31
6  ( 1 )  -&gt;  32
7  ( 1 )  -&gt;  33
8  ( 1 )  -&gt;  34
9  ( 1 )  -&gt;  35
</pre><h3><a class="anchor" id="sOpsHLevelAt"></a>
Get level and knot span</h3>
<p><a class="el" href="classgismo_1_1gsHTensorBasis.html#ae97fc497357b5073b012c2e9caf4d2cb" title="Returns the level(s) and knot span(s) at point(s) in the parameter domain.">gsHTensorBasis::getLevelUniqueSpanAtPoints()</a> will tell you the levels of certain points, as well as the knot span containing these points:</p>
<div class="fragment"><div class="line">    gsVector&lt;index_t&gt; resLevels;</div>
<div class="line">    gsMatrix&lt;index_t&gt; resLowerCorner;</div>
<div class="line"> </div>
<div class="line">    thb.getLevelUniqueSpanAtPoints(u, resLevels, resLowerCorner);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;levels:        &quot;</span> &lt;&lt; std::endl &lt;&lt; resLevels.transpose() &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;lower corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resLowerCorner        &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>In our example, this will return</p>
<pre class="fragment">levels: 
1 1 0
lower corners: 
7 7 2
0 2 3
</pre><p> These indices are given on the respective level.</p>
<h3><a class="anchor" id="sOpsHTree"></a>
Show tree-structure</h3>
<p>The <a class="el" href="classgismo_1_1gsHTensorBasis.html" title="Class representing a (scalar) hierarchical tensor basis of functions .">gsHTensorBasis</a> are based on a <a class="el" href="classgismo_1_1gsHDomain.html" title="Class with a hierarchical domain structure represented by a box k-d-tree.">gsHDomain</a>. The tree-structure (see references at the bottom) can be accessed by the member function <a class="el" href="classgismo_1_1gsHTensorBasis.html#ab5ad8e2f8d26ab4eb0d16ad64247e1dc" title="Returns a reference to m_tree.">gsHTensorBasis::tree()</a>. For example, this is how to take a look at the underlying tree-structure:</p>
<div class="fragment"><div class="line">    gsMatrix&lt;index_t&gt; resUpperCorner;</div>
<div class="line"> </div>
<div class="line">    thb.tree().getBoxes( resLowerCorner, resUpperCorner, resLevels);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;levels:        &quot;</span> &lt;&lt; std::endl &lt;&lt; resLevels      &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;lower corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resLowerCorner &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;upper corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resUpperCorner &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>In our example, this will return</p>
<pre class="fragment">levels:        
0
1
0
lower corners: 
2 4
2 0
0 0
upper corners: 
8 8
8 4
2 8
</pre><p> Note that these indices are given with respect to level <a class="el" href="classgismo_1_1gsHDomain.html#ab053991638a5dcb8e071c0746b589f99" title="Maximum level present in the tree.">gsHDomain::m_maxInsLevel</a>.</p>
<h1><a class="anchor" id="sRemRef"></a>
Remarks regarding refinement</h1>
<h2><a class="anchor" id="ssRefAreaSize"></a>
Size of refined area</h2>
<p>Keep in mind that fine functions are only added, if the refined area contains the support of at least one fine basis function! If only a single cell/element is refined, no fine functions are added (for \( p &gt; 1 \))! If necessary, extend the refinement area by a ring of cells around the refinement area.</p>
<h2><a class="anchor" id="sRefExtra"></a>
Additional refinement during refinement</h2>
<p>Take the hierarchical mesh from above, where \( \Omega^1 \) is now coloured light green. Refining the dark green area to level 2 will NOT result in the mesh shown in the middle. Instead, in order to avoid L-shaped elements, and due to some requirements by the underlying tree, the mesh shown on the right will be generated (with additional refinement in the orange areas).</p>
<div class="image">
<img src="tutTHB_2d_Tm2.png" alt=""/>
<div class="caption">
Level 1: light green. Level 2: dark green. Additional refinement: orange.</div></div>
<p>The hierarchical mesh and the corresponding THB-Spline basis:</p>
<div class="image">
<img src="tutTHB_2d_Tm2_T2.png" alt=""/>
<div class="caption">
Hierarchical mesh and THB-splines on 3 levels.</div></div>
<p>Applying this refinement to the basis and printing the basis...</p>
<div class="fragment"><div class="line">    box.clear();</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 4 );</div>
<div class="line">    box.push_back( 6 );</div>
<div class="line">    box.push_back( 10 );</div>
<div class="line"> </div>
<div class="line">    thb.refineElements(box);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;after 2nd refinement, this basis is:\n&quot;</span> &lt;&lt; thb &lt;&lt; std::endl;</div>
</div><!-- fragment --><p>...will return</p>
<pre class="fragment">after 2nd refinement, this basis is:
Truncated basis of dimension 2,
levels=3, size=70, tree_nodes=25).
Domain: [0 0]..[1 1].
Size per level: 30 32 8 
</pre><p>This should be kept in mind when manually creating THB-spline geometries.</p>
<h2><a class="anchor" id="sRefPresOfCoeff"></a>
Preservation of coefficients</h2>
<p>Assume you have given a certain spline geometry (curve, surface, volume,...) represented by tensor-product splines of level 0 with coefficients \( c^0_i \): </p><p class="formulaDsp">
\[ G(\xi) = \sum_{ \beta^0_i \in B^0} c^0_i \beta^0_i(\xi) \]
</p>
<p>The <em>same</em> geometry can be represented on level 1 with different coefficients \( c^1_j \): </p><p class="formulaDsp">
\[ G(\xi) = \sum_{ \beta^1_j \in B^1} c^1_j \beta^1_j(\xi) \]
</p>
<p>If an area \( \Omega^1 \subset \Omega^0 \) is refined to level 1, we obtain the THB-spline basis consisting of</p><ul>
<li>truncated coarse functions \( \mathrm{trunc}^1 \beta^0_i(\xi), \mathrm{supp} \beta^0_i \not \subseteq \Omega^1 \)</li>
<li>and fine functions \( \beta^1_j, \ \mathrm{supp} \beta^1_j \subseteq \Omega^1 \)</li>
</ul>
<p>The geometry \( G \) can be obtained <em>exactly</em> by taking the same coefficients \( c^0_j \) and \( c^1_j \) that were used on the respective levels:  </p><p class="formulaDsp">
\[ G(\xi) = 
\sum_{ \beta^0_i \in B^0,\ \mathrm{supp} \beta^0_i \not \subseteq \Omega^1} 
c^0_i\ \mathrm{trunc}^1 \beta^0_i(\xi) 
+ \sum_{ \beta^1_j \in B^1,\ \mathrm{supp} \beta^1_j \subseteq \Omega^1} 
c^1_j \beta^1_j(\xi) 
\]
</p>
<h1><a class="anchor" id="sReferences"></a>
References</h1>
<p>C. Giannelli, B. J&uuml;ttler, and H. Speleers. THB-splines: The truncated basis for hierarchical splines. Comput. Aided Geom. Design, 29(7):485-498, 2012. <a href="http://www.sciencedirect.com/science/article/pii/S0167839612000519">[Link]</a> <a href="http://www.ag.jku.at/pubs/2012gjs.pdf">[Technical&#160;Report]</a></p>
<p>C. Giannelli, B. J&uuml;ttler, and H. Speleers. Strongly stable bases for adaptively refined multilevel spline spaces. Adv. Comp. Math., 40(2):459-490, 2014. <a href="http://link.springer.com/article/10.1007/s10444-013-9315-2">[Link]</a> <a href="http://gs.jku.at/pubs/NFNreport3.pdf">[G+S&#160;Report&#160;No.&#160;3]</a></p>
<p>C. Giannelli, B. J&uuml;ttler, S.K. Kleiss, A. Mantzaflaris, B. Simeon, J. Speh: THB-splines: An Effective Mathematical Technology for Adaptive Refinement in Geometric Design and Isogeometric Analysis. NFN Technical Report No. 30. <a href="http://www.sciencedirect.com/science/article/pii/S0045782515003540">[Link]</a> <a href="http://gs.jku.at/pubs/NFNreport30.pdf">[G+S&#160;Report&#160;No.&#160;30]</a></p>
<p>G. Kiss, C. Giannelli, B. Jüttler: Algorithms and Data structures for truncated hierarchical B-splines. Mathematical Methods for Curves and Surfaces. Ed. by M. Floater et al. Vol. 8177. Lecture Notes in Computer Science. Springer, 2014, pp 304 - 323. <a href="http://link.springer.com/chapter/10.1007/978-3-642-54382-1_18">[Link]</a> <a href="http://www.ag.jku.at/pubs/2013kgj.pdf">[Technical&#160;Report]</a></p>
<h1><a class="anchor" id="thbSplineBasis_exampleAnnotated"></a>
Annotated source file</h1>
<p>Here is the full file <code>examples/thbSplineBasis_example.cpp</code>. Clicking on a function or class name will lead you to its reference documentation.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">// Look also in basis_example and bSplineBasis_example.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gismo_8h.html">gismo.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacegismo.html">gismo</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> plot = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsCmdLine.html">gsCmdLine</a> cmd(<span class="stringliteral">&quot;Tutorial on solving a Poisson problem.&quot;</span>);</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;plot&quot;</span>, <span class="stringliteral">&quot;Create a ParaView visualization file with the solution&quot;</span>, plot);</div>
<div class="line">    <span class="keywordflow">try</span> { cmd.getValues(argc,argv); } <span class="keywordflow">catch</span> (<span class="keywordtype">int</span> rv) { <span class="keywordflow">return</span> rv; }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- construction of a THB-spline basis ---------------</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set up and construct a knot vector...</span></div>
<div class="line">    real_t a = 0;                   <span class="comment">// starting knot</span></div>
<div class="line">    real_t b = 1;                   <span class="comment">// ending knot</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> interior = 3;          <span class="comment">// number of interior knots</span></div>
<div class="line">    <span class="keywordtype">int</span>      degree = 2;</div>
<div class="line">    <span class="keywordtype">unsigned</span> multEnd = degree + 1;  <span class="comment">// multiplicity at the two end knots</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsKnotVector.html">gsKnotVector&lt;&gt;</a> kv(a, b, interior, multEnd);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...a 2D-tensor-B-spline basis with this knot vector...</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsTensorBSplineBasis.html">gsTensorBSplineBasis&lt;2,real_t&gt;</a> tens( kv, kv );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...and a 2D-THB-spline basis out of the tensor-B-spline basis.</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsTHBSplineBasis.html">gsTHBSplineBasis&lt;2,real_t&gt;</a> thb( tens );</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;basis before refinement:\n&quot;</span> &lt;&lt; thb &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Export the initial basis to paraview files</span></div>
<div class="line">    gsWriteParaview(thb, <span class="stringliteral">&quot;thb0_init&quot;</span> );</div>
<div class="line"> </div>
<div class="line">    std::vector&lt;index_t&gt; box;</div>
<div class="line">    box.push_back( 1 );</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 0 );</div>
<div class="line">    box.push_back( 8 );</div>
<div class="line">    box.push_back( 4 );</div>
<div class="line"> </div>
<div class="line">    thb.refineElements(box);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Export the refined basis to paraview files</span></div>
<div class="line">    gsWriteParaview(thb, <span class="stringliteral">&quot;thb_refined_first&quot;</span> );</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;after refinement,&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;this basis is:\n&quot;</span> &lt;&lt; thb &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- &quot;standard&quot; evaluations ---------------</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;real_t&gt;</a> u(2,3);</div>
<div class="line">    u(0,0) = 0.95;</div>
<div class="line">    u(1,0) = 0.05;</div>
<div class="line"> </div>
<div class="line">    u(0,1) = 0.95;</div>
<div class="line">    u(1,1) = 0.3;</div>
<div class="line"> </div>
<div class="line">    u(0,2) = 0.6;</div>
<div class="line">    u(1,2) = 0.9;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;index_t&gt;</a> resActives;</div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;real_t&gt;</a>   resEvals;</div>
<div class="line"> </div>
<div class="line">    thb.active_into( u, resActives);</div>
<div class="line">    thb.eval_into(   u, resEvals);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;active functions: \n&quot;</span> &lt;&lt; resActives &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;their values:     \n&quot;</span> &lt;&lt; resEvals   &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- index-computations ---------------</span></div>
<div class="line"> </div>
<div class="line">    std::vector&lt;unsigned&gt; tmpFlatIndices;</div>
<div class="line">    std::vector&lt;int&gt;      tmpLevels;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;transform indices\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;global/hier.index  -&gt;  flat tensor index (on level)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 27; i &lt;= 35; i++)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// print computed indices/levels</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; i;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  -&gt;  &quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; thb.flatTensorIndexOf(i);</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  ( &quot;</span> &lt;&lt; thb.levelOf(i) &lt;&lt; <span class="stringliteral">&quot; )&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// store indices/levels for reverse transformation later</span></div>
<div class="line">        tmpFlatIndices.push_back( thb.flatTensorIndexOf(i) );</div>
<div class="line">        tmpLevels.push_back(  thb.levelOf(i) );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;reverse index transformation\n&quot;</span>;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;flat tensor index (on level)  -&gt;  global/hier.index&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> i = 0; i &lt; tmpLevels.size(); i++ )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// print global/hierarchical indices</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; tmpFlatIndices[i] &lt;&lt; <span class="stringliteral">&quot;  ( &quot;</span> &lt;&lt; tmpLevels[i] &lt;&lt; <span class="stringliteral">&quot; )&quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;  -&gt;  &quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; thb.flatTensorIndexToHierachicalIndex( tmpFlatIndices[i], tmpLevels[i] ) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- some gsHTensorBasis-specific functions ---------------</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsVector.html">gsVector&lt;index_t&gt;</a> resLevels;</div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;index_t&gt;</a> resLowerCorner;</div>
<div class="line"> </div>
<div class="line">    thb.getLevelUniqueSpanAtPoints(u, resLevels, resLowerCorner);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;levels:        &quot;</span> &lt;&lt; std::endl &lt;&lt; resLevels.transpose() &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;lower corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resLowerCorner        &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// print the underlying tree</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;index_t&gt;</a> resUpperCorner;</div>
<div class="line"> </div>
<div class="line">    thb.tree().getBoxes( resLowerCorner, resUpperCorner, resLevels);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;levels:        &quot;</span> &lt;&lt; std::endl &lt;&lt; resLevels      &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;lower corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resLowerCorner &lt;&lt; std::endl;</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;upper corners: &quot;</span> &lt;&lt; std::endl &lt;&lt; resUpperCorner &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- 2nd local refinement ---------------</span></div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    box.clear();</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 2 );</div>
<div class="line">    box.push_back( 4 );</div>
<div class="line">    box.push_back( 6 );</div>
<div class="line">    box.push_back( 10 );</div>
<div class="line"> </div>
<div class="line">    thb.refineElements(box);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;after 2nd refinement, this basis is:\n&quot;</span> &lt;&lt; thb &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    gsWriteParaview(thb, <span class="stringliteral">&quot;thb_refined_second&quot;</span> );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1boxSide.html">boxSide</a> side(1);</div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;index_t&gt;</a> result = thb.boundaryOffset(1,0);</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Basis indices along side &quot;</span>&lt;&lt;side&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;result.transpose()&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> k=1; k&lt;5; k++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_struct" href="structgismo_1_1boxCorner.html">boxCorner</a> corner(k);</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a>&lt;&lt;<span class="stringliteral">&quot;Basis function index in corner &quot;</span>&lt;&lt;corner&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;thb.functionAtCorner(corner)&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// --------------- plot basis after 1 refinement ---------------</span></div>
<div class="line">    <span class="keywordflow">if</span>( plot )</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Run paraview</span></div>
<div class="line">        <a class="code hl_function" href="classgismo_1_1gsFileManager.html#a0f725eecb78d3bc1f482326cb9e85eee">gsFileManager::open</a>(<span class="stringliteral">&quot;thb1_refined.pvd&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Done. No output created, re-run with --plot to get a ParaView &quot;</span></div>
<div class="line">                  <span class="stringliteral">&quot;file containing the solution.\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="aclassgismo_1_1boxSide_html"><div class="ttname"><a href="classgismo_1_1boxSide.html">gismo::boxSide</a></div><div class="ttdoc">Struct which represents a certain side of a box.</div><div class="ttdef"><b>Definition</b> gsBoundary.h:85</div></div>
<div class="ttc" id="aclassgismo_1_1gsCmdLine_html"><div class="ttname"><a href="classgismo_1_1gsCmdLine.html">gismo::gsCmdLine</a></div><div class="ttdoc">Class for command-line argument parsing.</div><div class="ttdef"><b>Definition</b> gsCmdLine.h:57</div></div>
<div class="ttc" id="aclassgismo_1_1gsFileManager_html_a0f725eecb78d3bc1f482326cb9e85eee"><div class="ttname"><a href="classgismo_1_1gsFileManager.html#a0f725eecb78d3bc1f482326cb9e85eee">gismo::gsFileManager::open</a></div><div class="ttdeci">static void open(const std::string &amp;fn)</div><div class="ttdoc">Opens the file fn using the preferred application of the OS.</div><div class="ttdef"><b>Definition</b> gsFileManager.cpp:688</div></div>
<div class="ttc" id="aclassgismo_1_1gsKnotVector_html"><div class="ttname"><a href="classgismo_1_1gsKnotVector.html">gismo::gsKnotVector</a></div><div class="ttdoc">Class for representing a knot vector.</div><div class="ttdef"><b>Definition</b> gsKnotVector.h:80</div></div>
<div class="ttc" id="aclassgismo_1_1gsMatrix_html"><div class="ttname"><a href="classgismo_1_1gsMatrix.html">gismo::gsMatrix</a></div><div class="ttdoc">A matrix with arbitrary coefficient type and fixed or dynamic size.</div><div class="ttdef"><b>Definition</b> gsMatrix.h:41</div></div>
<div class="ttc" id="aclassgismo_1_1gsTHBSplineBasis_html"><div class="ttname"><a href="classgismo_1_1gsTHBSplineBasis.html">gismo::gsTHBSplineBasis</a></div><div class="ttdoc">Truncated hierarchical B-spline basis.</div><div class="ttdef"><b>Definition</b> gsTHBSplineBasis.h:36</div></div>
<div class="ttc" id="aclassgismo_1_1gsTensorBSplineBasis_html"><div class="ttname"><a href="classgismo_1_1gsTensorBSplineBasis.html">gismo::gsTensorBSplineBasis</a></div><div class="ttdoc">A tensor product B-spline basis.</div><div class="ttdef"><b>Definition</b> gsTensorBSplineBasis.h:37</div></div>
<div class="ttc" id="aclassgismo_1_1gsVector_html"><div class="ttname"><a href="classgismo_1_1gsVector.html">gismo::gsVector</a></div><div class="ttdoc">A vector with arbitrary coefficient type and fixed or dynamic size.</div><div class="ttdef"><b>Definition</b> gsVector.h:37</div></div>
<div class="ttc" id="agismo_8h_html"><div class="ttname"><a href="gismo_8h.html">gismo.h</a></div><div class="ttdoc">Main header to be included by clients using the G+Smo library.</div></div>
<div class="ttc" id="agsConfig_8h_html_ad722078677c063a09661059674fb996c"><div class="ttname"><a href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a></div><div class="ttdeci">#define index_t</div><div class="ttdef"><b>Definition</b> gsConfig.h:32</div></div>
<div class="ttc" id="anamespacegismo_html"><div class="ttname"><a href="namespacegismo.html">gismo</a></div><div class="ttdoc">The G+Smo namespace, containing all definitions for the library.</div></div>
<div class="ttc" id="astructgismo_1_1boxCorner_html"><div class="ttname"><a href="structgismo_1_1boxCorner.html">gismo::boxCorner</a></div><div class="ttdoc">Struct which represents a certain corner of a hyper-cube.</div><div class="ttdef"><b>Definition</b> gsBoundary.h:292</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jan 20 2025 09:35:27 for G+Smo by Doxygen v1.9.8 </li>
  </ul>
</div>
<!-- Piwik --> 
<!--
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.sylphide-consulting.com/piwik/" : "http://stats.sylphide-consulting.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 20);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.sylphide-consulting.com/piwik/piwik.php?idsite=20" style="border:0" alt="" /></p></noscript>
-->
<!-- End Piwik Tracking Code -->
</body>
</html>
