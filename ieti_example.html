<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<title>G+Smo: ieti_example.cpp</title>
<link href="gismodoxy_tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://people.ricam.oeaw.ac.at/gismo/mj/MathJax.js"></script>
<link href="doxygen.css"   rel="stylesheet" type="text/css" />
<link href="gismodoxy.css" rel="stylesheet" type="text/css">
<!--  -->
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="gslogo-doxy.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="index.html"><font style="font-variant:small-caps;">G+S</font><font style="font-variant:small-caps;"
															    color="#000000">mo</font></a>
   &#160;<span id="projectnumber">25.01.0</span>
   </div>
   <div id="projectbrief">Geometry + Simulation Modules</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ieti_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ieti_example.cpp</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We consider the Poisson boundary value problem (for simplicity here only with Dirichlet conditions):  </p><p class="formulaDsp">
\begin{eqnarray*}
                    -\Delta u &amp;=&amp; f \quad \text{in} \quad \Omega,         \\
                            u &amp;=&amp; g \quad \text{on} \quad \partial\Omega.
\end{eqnarray*}
</p>
<p> Its variational form is: Find \( u\in V_g \) such that  </p><p class="formulaDsp">
\[
    \int_\Omega \nabla u \nabla v d x = \int_\Omega f v dx
\]
</p>
<p> for all \( v\in V_0 \), which corresponds to the linear system  </p><p class="formulaDsp">
\[
      A \underline u = \underline f.
\]
</p>
<p>The computational domain is a non-overlapping multi-patch domain:  </p><p class="formulaDsp">
\[
      \overline{ \Omega } = \bigcup_{k=1}^K \overline{ \Omega_k }
\]
</p>
  <p class="formulaDsp">
\[
      \Omega_k \cap \Omega_l = \emptyset
      \quad \text{ for all } k\not=l.
\]
</p>
<p> On each patch, we have a isogeometric function space \( V_k \). We assume that the function spaces are <em>fully matching</em>. The global function space is  </p><p class="formulaDsp">
\[
        V_h = \{ v\in V \;:\;  v|_{\Omega_k} \in V_k \}
\]
</p>
<p> where \( V \) is the proper continuous space.</p>
<p>After reading the command line arguments, we read in the geometry file and modify the geometry as desired:</p>
<div class="fragment"><div class="line">    <a class="code hl_typedef" href="classgismo_1_1gsMultiPatch.html#ad7190c68d8ead80bd1b6fd7256779894">gsMultiPatch&lt;&gt;::uPtr</a> mpPtr = gsReadFile&lt;&gt;(geometry);</div>
<div class="ttc" id="aclassgismo_1_1gsMultiPatch_html_ad7190c68d8ead80bd1b6fd7256779894"><div class="ttname"><a href="classgismo_1_1gsMultiPatch.html#ad7190c68d8ead80bd1b6fd7256779894">gismo::gsMultiPatch::uPtr</a></div><div class="ttdeci">memory::unique_ptr&lt; gsMultiPatch &gt; uPtr</div><div class="ttdoc">Unique pointer for gsMultiPatch.</div><div class="ttdef"><b>Definition</b> gsMultiPatch.h:109</div></div>
</div><!-- fragment --> <div class="fragment"><div class="line">    gsMultiPatch&lt;&gt;&amp; mp = *mpPtr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i=0; i&lt;splitPatches; ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;split patches uniformly... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        mp = mp.uniformSplit();</div>
<div class="line">    }</div>
<div class="ttc" id="agsConfig_8h_html_ad722078677c063a09661059674fb996c"><div class="ttname"><a href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a></div><div class="ttdeci">#define index_t</div><div class="ttdef"><b>Definition</b> gsConfig.h:32</div></div>
<div class="ttc" id="agsDebug_8h_html_af6177e1e282640c3cb9175565f84a432"><div class="ttname"><a href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a></div><div class="ttdeci">#define gsInfo</div><div class="ttdef"><b>Definition</b> gsDebug.h:43</div></div>
</div><!-- fragment --><p>Then, we set up the right-hand-side f and a <em><a class="el" href="classgismo_1_1gsBoundaryConditions.html" title="Class containing a set of boundary conditions.">gsBoundaryConditions</a></em> object based on the command line arguments.</p>
<div class="fragment"><div class="line">    <span class="comment">// Right-hand-side</span></div>
<div class="line">    gsFunctionExpr&lt;&gt; f( <span class="stringliteral">&quot;2*sin(x)*cos(y)&quot;</span>, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Dirichlet function</span></div>
<div class="line">    gsFunctionExpr&lt;&gt; gD( <span class="stringliteral">&quot;sin(x)*cos(y)&quot;</span>, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Neumann</span></div>
<div class="line">    gsConstantFunction&lt;&gt; gN( 1.0, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    gsBoundaryConditions&lt;&gt; bc;</div>
</div><!-- fragment --><p>Then, we extract the basis from the multi patch object to obtain a multi basis.</p>
<div class="fragment"><div class="line">    gsMultiBasis&lt;&gt; mb(mp);</div>
</div><!-- fragment --><p>We set the spline degree and the grid size as desired.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0; i &lt; mb.nBases(); ++ i )</div>
<div class="line">        mb[i].setDegreePreservingMultiplicity(degree);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i = 0; i &lt; refinements; ++i )</div>
<div class="line">        mb.uniformRefine();</div>
</div><!-- fragment --><p>Now, we can discuss the IETI system.</p>
<p>We are considering patch-wise formulations of the variational formulation:  </p><p class="formulaDsp">
\[
    \int_{\Omega_k} \nabla u \nabla v d x = \int_{\Omega_k} f v dx
\]
</p>
<p> Each of these bilinear forms and linear forms lead to matrices and vectors  </p><p class="formulaDsp">
\[
      A_k \qquad\text{and}\qquad \underline f_k.
\]
</p>
<p>Using the jump matrices \( B_k \), which are provided by the class <em><a class="el" href="classgismo_1_1gsIetiMapper.html" title="Ieti Mapper.">gsIetiMapper</a></em>, we obtain the following problem:</p>
<p class="formulaDsp">
\[
    \begin{pmatrix}
        A_1 &amp;     &amp;      &amp;     &amp; B_1^\top \\
            &amp; A_2 &amp;      &amp;     &amp; B_2^\top \\
            &amp;     &amp;\ddots&amp;     &amp; \vdots   \\
            &amp;     &amp;      &amp; A_K &amp; B_K^\top \\
        B_1 &amp; B_2 &amp;\cdots&amp; B_K &amp;   0      \\
    \end{pmatrix}
    \begin{pmatrix}
        \underline u_1 \\
        \underline u_2 \\
        \vdots         \\
        \underline u_K \\
        \underline \lambda
    \end{pmatrix}
    =
    \begin{pmatrix}
        \underline f_1 \\
        \underline f_2 \\
        \vdots         \\
        \underline f_K \\
        0
    \end{pmatrix}
\]
</p>
<p>This is the kind of systems, the class <em><a class="el" href="classgismo_1_1gsIetiSystem.html" title="This class represents a IETI system.">gsIetiSystem</a></em> is working with. The problem is that &ndash; in general &ndash; the matrices \( A_k \) are singular. To circumvent this problem, in FETI-dp / IETI-dp methods, we use primal degrees of freedom, like vertex values or edge averages.</p>
<p>These primal dofs are handled by the classes <em><a class="el" href="classgismo_1_1gsPrimalSystem.html" title="This class represents the primal system for a IETI-DP algorithm.">gsPrimalSystem</a></em> and again <em><a class="el" href="classgismo_1_1gsIetiMapper.html" title="Ieti Mapper.">gsIetiMapper</a></em>. The IETI mapper provides vectors \( c_k^{(i)} \) that realize the <em>constraint</em> that the primal dof is set to zero. For each patch, these <em>primal constraints</em> build a matrix \( C_k \). The IETI mapper also provides a vector of indices that associates each of these primal constraints to a (global) index referring to the primal dof.</p>
<p>Finally, we obtain one subspace (the K+1st) that refers to the primal degrees of freedom.</p>
<p>We have the following IETI system:  </p><p class="formulaDsp">
\[
    \begin{pmatrix}
       \tilde A_1 &amp;            &amp;             &amp;                &amp;  \tilde B_1^\top     \\
                  &amp; \tilde A_2 &amp;             &amp;                &amp;  \tilde B_2^\top     \\
                  &amp;            &amp;   \ddots    &amp;                &amp;  \vdots              \\
                  &amp;            &amp;             &amp; \tilde A_{K+1} &amp;  \tilde B_{K+1}^\top \\
       \tilde B_1 &amp; \tilde B_2 &amp;   \cdots    &amp; \tilde B_{K+1} &amp;     0                \\
    \end{pmatrix}
    \begin{pmatrix}
        \underline{ \tilde u}_1     \\
        \underline{ \tilde u}_2     \\
        \vdots                      \\
        \underline{ \tilde u}_{K+1} \\
        \underline \lambda
    \end{pmatrix}
    =
    \begin{pmatrix}
        \underline{ \tilde f}_1     \\
        \underline{ \tilde f}_2     \\
        \vdots                     \\
        \underline{ \tilde f}_{K+1} \\
        0
    \end{pmatrix},
    \qquad (*)
\]
</p>
<p> which is passed to the class <em><a class="el" href="classgismo_1_1gsIetiSystem.html" title="This class represents a IETI system.">gsIetiSystem</a></em>. For \( k=1,\ldots,K \), we have the local saddle point system  </p><p class="formulaDsp">
\[
     \tilde{A}_k
     =
     \begin{pmatrix}
           A_k   &amp; C_k^\top \\
           C_k   &amp;  0
      \end{pmatrix},
\]
</p>
<p> the extended jump matrix  </p><p class="formulaDsp">
\[
     \tilde{B}_k
     =
     B_k (P_0^{(k)})^\top
     =
     \begin{pmatrix}
         B_k   &amp;   0_k
     \end{pmatrix}
\]
</p>
<p> and the extended right-hand side  </p><p class="formulaDsp">
\[
     \underline{\tilde f}_k
     =
     P_0^{(k)} \underline f_k
     =
     \begin{pmatrix}
         \underline f_k \\ 0
     \end{pmatrix}.
\]
</p>
<p> These modifications are provided by <em><a class="el" href="classgismo_1_1gsPrimalSystem.html" title="This class represents the primal system for a IETI-DP algorithm.">gsPrimalSystem</a></em>. The class <em><a class="el" href="classgismo_1_1gsPrimalSystem.html" title="This class represents the primal system for a IETI-DP algorithm.">gsPrimalSystem</a></em> moreover computes the energy minimizing basis functions and represents them as matrices \( \Psi_k = (P_c^{(k)})^\top \tilde{A}_k^{-1} R_c \), where \( R_c=(0,I)^\top \) and \( P_c=(I,0) \). It then computes  </p><p class="formulaDsp">
\[
      \tilde A_{K+1} = \sum_{k=1}^K \Psi_k A_k \Psi_k^\top
      \quad\text{and}\quad
      \tilde B_{K+1} = \sum_{k=1}^K B_k \Psi_k^\top
      \quad\text{and}\quad
      \underline{\tilde f}_{K+1} = \sum_{k=1}^K \Psi_k \underline f_k.
\]
</p>
<p>By setting a corresponding flag, it is possible to eliminate the pointwise constraints. A constraint is pointwise the correspoding row of \( C_k \) has only one non-zero entries. Typically, the corner values are pointwise constraints.</p>
<p>Instead of directly solving the IETI-saddle point system (*), we solve the corresponding Schur complement system  </p><p class="formulaDsp">
\[
      F \underline \lambda = \underline g,
\]
</p>
<p> where  </p><p class="formulaDsp">
\[
    F = \sum_{k=1}^{K+1} \tilde B_k \tilde A_k^{-1} \tilde B_k^\top
    \quad\text{and}\quad
    \underline g = \sum_{k=1}^{K+1} \tilde B_k \tilde A_k^{-1} \underline{\tilde f}_k.
\]
</p>
<p> The Schur complement system is preconditioned with the scaled Dirichlet preconditioner  </p><p class="formulaDsp">
\[
    M_{sD}
    = \sum_{k=1}^{K} \hat B_k D_k^{-1} S_k D_k^{-1} \hat B_k^\top,
\]
</p>
<p> where \( S_k \) is the Schur complement of \( A_k \) (not: \(\tilde A_k\)) with respect to the dofs on the interfaces. \( \hat B_k \) is the restriction of \( B_k \) to the dofs on the interfaces. \( D_k \) is a scaling matrix, e.g., based on multiplicity scaling. The class <em><a class="el" href="classgismo_1_1gsScaledDirichletPrec.html" title="This class represents the scaled Dirichlet preconditioner for a IETI problem.">gsScaledDirichletPrec</a></em> not only collects the contributions of the preconditioner; it also helps with restricting to the skeleton and computing the Schur complement.</p>
<p>In the example file <em>ieti2_example.cpp</em>, we solve the saddle point system (*) with a MINRES solver, preconditioned with a block-diagonal preconditioner, where the last block is \( M_{sD} \).</p>
<p>First, we set up the <em><a class="el" href="classgismo_1_1gsIetiMapper.html" title="Ieti Mapper.">gsIetiMapper</a></em> object, which helps us with assembling and keeping track of the dof indices.</p>
<div class="fragment"><div class="line">    gsIetiMapper&lt;&gt; ietiMapper;</div>
</div><!-- fragment --><p>For initializing the IETI mapper, it is necessary to provide a <em><a class="el" href="classgismo_1_1gsDofMapper.html" title="Maintains a mapping from patch-local dofs to global dof indices and allows the elimination of individ...">gsDofMapper</a></em> for the global problem and the function values for the eliminated dofs (typically the Dirichlet conditions). If systems are considered, the method it is expected to have one IETI mapper per variable.</p>
<p>For obtaining a <em><a class="el" href="classgismo_1_1gsDofMapper.html" title="Maintains a mapping from patch-local dofs to global dof indices and allows the elimination of individ...">gsDofMapper</a></em>, we use the assembler:</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#ae06340b104d0849a61073ea57edbf46c">gsExprAssembler&lt;&gt;::space</a>  space;</div>
<div class="line">        gsExprAssembler&lt;&gt; assembler;</div>
<div class="line">        space u = assembler.getSpace(mb);</div>
<div class="line">        bc.setGeoMap(mp);</div>
<div class="line">        u.setup(bc, dirichlet::interpolation, 0);</div>
<div class="line">        ietiMapper.init( mb, u.mapper(), u.fixedPart() );</div>
<div class="line">    }</div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_ae06340b104d0849a61073ea57edbf46c"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#ae06340b104d0849a61073ea57edbf46c">gismo::gsExprAssembler::space</a></div><div class="ttdeci">gsExprHelper&lt; T &gt;::space space</div><div class="ttdoc">Space type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:67</div></div>
</div><!-- fragment --><p>Now we set the primal degrees of freedom. The following commands compute the (vectors that make up the) constraint matrices \( C_k \) and store them in the <em><a class="el" href="classgismo_1_1gsIetiMapper.html" title="Ieti Mapper.">gsIetiMapper</a></em> object.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (cornersAsPrimals)</div>
<div class="line">        ietiMapper.cornersAsPrimals();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (edgesAsPrimals)</div>
<div class="line">        ietiMapper.interfaceAveragesAsPrimals(mp,1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (facesAsPrimals)</div>
<div class="line">        ietiMapper.interfaceAveragesAsPrimals(mp,2);</div>
</div><!-- fragment --><p>The following command computes the jump matrices \( B_k \) and stores them in the <em><a class="el" href="classgismo_1_1gsIetiMapper.html" title="Ieti Mapper.">gsIetiMapper</a></em> object.</p>
<div class="fragment"><div class="line">    ietiMapper.computeJumpMatrices(fullyRedundant, noLagrangeMultipliersForCorners);</div>
</div><!-- fragment --><p>Now, we set up the classes for the IETI system, the primal system, and the scaled Dirichlet preconditioner.</p>
<div class="fragment"><div class="line">    <span class="comment">// The ieti system does not have a special treatment for the</span></div>
<div class="line">    <span class="comment">// primal dofs. They are just one more subdomain</span></div>
<div class="line">    gsIetiSystem&lt;&gt; ieti;</div>
<div class="line">    ieti.reserve(nPatches+1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The scaled Dirichlet preconditioner is independent of the</span></div>
<div class="line">    <span class="comment">// primal dofs.</span></div>
<div class="line">    gsScaledDirichletPrec&lt;&gt; prec;</div>
<div class="line">    prec.reserve(nPatches);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup the primal system, which needs to know the number of primal dofs.</span></div>
<div class="line">    gsPrimalSystem&lt;&gt; primal(ietiMapper.nPrimalDofs());</div>
<div class="line">    <span class="keywordflow">if</span> (eliminateCorners)</div>
<div class="line">        primal.setEliminatePointwiseConstraints(<span class="keyword">true</span>);</div>
</div><!-- fragment --><p>Now, we assemble the linear system and the right-hand side on each patch using a for loop. We use local versions of the geometry (<em><a class="el" href="classgismo_1_1gsMultiPatch.html" title="Container class for a set of geometry patches and their topology, that is, the interface connections ...">gsMultiPatch</a></em>), the basis (<em><a class="el" href="classgismo_1_1gsMultiBasis.html" title="Holds a set of patch-wise bases and their topology information.">gsMultiBasis</a></em>) and the boundary conditions (<em><a class="el" href="classgismo_1_1gsBoundaryConditions.html" title="Class containing a set of boundary conditions.">gsBoundaryConditions</a></em>).</p>
<p>The function initFeSpace provides a new dof mapper and the Dirichlet data. This is necessary since it might happen that a 2d-patch touches the Dirichlet boundary just with a corner or that a 3d-patch touches the Dirichlet boundary with a corner or an edge. These cases are not covered by bc.getConditionsForPatch</p>
<p>The example file <em>ieti2_example.cpp</em> shows how to assemble with a classical assembler.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> k=0; k&lt;nPatches; ++k)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We use the local variants of everything</span></div>
<div class="line">        gsBoundaryConditions&lt;&gt; bc_local;</div>
<div class="line">        bc.getConditionsForPatch(k,bc_local);</div>
<div class="line">        gsMultiPatch&lt;&gt; mp_local = mp[k];</div>
<div class="line">        gsMultiBasis&lt;&gt; mb_local = mb[k];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// The usual stuff for the expression assembler</span></div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#a16c60fa6666b6a61c747b016c385a4e2">gsExprAssembler&lt;&gt;::geometryMap</a> geometryMap;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#a5ced41a743a881bd3f93b0dfee29a38c">gsExprAssembler&lt;&gt;::variable</a>    variable;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#ae06340b104d0849a61073ea57edbf46c">gsExprAssembler&lt;&gt;::space</a>       space;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#aa2c9456b2c52d7b912894815a3c593da">gsExprAssembler&lt;&gt;::solution</a>    solution;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We set up the assembler</span></div>
<div class="line">        gsExprAssembler&lt;&gt; assembler(1,1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Elements used for numerical integration</span></div>
<div class="line">        assembler.setIntegrationElements(mb_local);</div>
<div class="line">        gsExprEvaluator&lt;&gt; ev(assembler);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the geometry map</span></div>
<div class="line">        geometryMap G = assembler.getMap(mp_local);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the discretization space</span></div>
<div class="line">        space u = assembler.getSpace(mb_local);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Incorporate Dirichlet BC</span></div>
<div class="line">        bc_local.setGeoMap(mp_local);</div>
<div class="line">        u.setup(bc_local, dirichlet::interpolation, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// This function provides a new dof mapper and the Dirichlet data</span></div>
<div class="line">        <span class="comment">// This is necessary since it might happen that a 2d-patch touches the</span></div>
<div class="line">        <span class="comment">// Dirichlet boundary just with a corner or that a 3d-patch touches the</span></div>
<div class="line">        <span class="comment">// Dirichlet boundary with a corner or an edge. These cases are not</span></div>
<div class="line">        <span class="comment">// covered by bc.getConditionsForPatch</span></div>
<div class="line">        ietiMapper.initFeSpace(u,k);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the source term</span></div>
<div class="line">        <span class="keyword">auto</span> ff = assembler.getCoeff(f, G);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Initialize the system</span></div>
<div class="line">        assembler.initSystem();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compute the system matrix and right-hand side</span></div>
<div class="line">        assembler.assemble( igrad(u, G) * igrad(u, G).tr() * meas(G), u * ff * meas(G) );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add contributions from Neumann conditions to right-hand side</span></div>
<div class="line">        variable g_N = assembler.getBdrFunction();</div>
<div class="line">        assembler.assembleBdr(bc_local.get(<span class="stringliteral">&quot;Neumann&quot;</span>),  u * g_N.val() * nv(G).norm() );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fetch data</span></div>
<div class="line">        gsSparseMatrix&lt;real_t, RowMajor&gt; jumpMatrix  = ietiMapper.jumpMatrix(k);</div>
<div class="line">        gsSparseMatrix&lt;&gt;                 localMatrix = assembler.matrix();</div>
<div class="line">        gsMatrix&lt;&gt;                       localRhs    = assembler.rhs();</div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_a16c60fa6666b6a61c747b016c385a4e2"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#a16c60fa6666b6a61c747b016c385a4e2">gismo::gsExprAssembler::geometryMap</a></div><div class="ttdeci">gsExprHelper&lt; T &gt;::geometryMap geometryMap</div><div class="ttdoc">Geometry map type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:65</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_a5ced41a743a881bd3f93b0dfee29a38c"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#a5ced41a743a881bd3f93b0dfee29a38c">gismo::gsExprAssembler::variable</a></div><div class="ttdeci">gsExprHelper&lt; T &gt;::variable variable</div><div class="ttdoc">Variable type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:66</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html_aa2c9456b2c52d7b912894815a3c593da"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html#aa2c9456b2c52d7b912894815a3c593da">gismo::gsExprAssembler::solution</a></div><div class="ttdeci">expr::gsFeSolution&lt; T &gt; solution</div><div class="ttdoc">Solution type.</div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:68</div></div>
</div><!-- fragment --><p>Now, we tell the preconditioner about the local matrix \( A_k \), the local vector \( \underline f_k \) and the matrix \( B_k \). This is done before the class <em><a class="el" href="classgismo_1_1gsPrimalSystem.html" title="This class represents the primal system for a IETI-DP algorithm.">gsPrimalSystem</a></em> modifies these objects. The following command does all necessary steps:</p>
<div class="fragment"><div class="line">        prec.addSubdomain(</div>
<div class="line">            <a class="code hl_function" href="classgismo_1_1gsScaledDirichletPrec.html#a86cc8713a2cce01c39f90f33203f2e6a">gsScaledDirichletPrec&lt;&gt;::restrictToSkeleton</a>(</div>
<div class="line">                jumpMatrix,</div>
<div class="line">                localMatrix,</div>
<div class="line">                ietiMapper.skeletonDofs(k)</div>
<div class="line">            )</div>
<div class="line">        );</div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html_a86cc8713a2cce01c39f90f33203f2e6a"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html#a86cc8713a2cce01c39f90f33203f2e6a">gismo::gsScaledDirichletPrec::restrictToSkeleton</a></div><div class="ttdeci">static std::pair&lt; JumpMatrix, OpPtr &gt; restrictToSkeleton(const JumpMatrix &amp;jumpMatrix, const SparseMatrix &amp;localMatrix, const std::vector&lt; index_t &gt; &amp;dofs)</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.h:195</div></div>
</div><!-- fragment --><p>This can also be done in a step-by-step way, for example if one does not want to use a sparse Cholesky solver (which requires symmetric positive definite problems and would be done by default). This is shown in <em>ieti2_example.cpp</em>.</p>
<p>As next step, we treat the primal dofs. We first compute energy minimizing primal basis functions. Then the following commands amends the variables jumpMatrix, localMatrix, and localRhs, which hold \( B_k \), \( A_k \) and \( \underline f_k \) before calling the function and \( \tilde B_k \), \( \tilde A_k \), and \( \underline{\tilde f}_k \) thereafter. Finally, this function collects the contributions for \( \tilde B_{K+1} \), \( \tilde A_{K+1} \), and \( \underline{\tilde f}_{K+1} \) in the object.</p>
<div class="fragment"><div class="line">        primal.handleConstraints(</div>
<div class="line">            ietiMapper.primalConstraints(k),</div>
<div class="line">            ietiMapper.primalDofIndices(k),</div>
<div class="line">            jumpMatrix,</div>
<div class="line">            localMatrix,</div>
<div class="line">            localRhs</div>
<div class="line">        );</div>
</div><!-- fragment --><p>This can also be done in a step-by-step way, for example if one does not want to use a sparse LU solver (which would be done by default). This is shown in the file <em>ieti2_example.cpp</em>.</p>
<p>Now, we add \( \tilde B_k \), \( \tilde A_k \), and \( \underline{\tilde f}_k \) to the IETI-system:</p>
<div class="fragment"><div class="line">        ieti.addSubdomain(</div>
<div class="line">            jumpMatrix.moveToPtr(),</div>
<div class="line">            makeMatrixOp(localMatrix.moveToPtr()),</div>
<div class="line">            <a class="code hl_function" href="namespacegismo.html#ab72442c3b5aeef49b3c60f6e9df77110">give</a>(localRhs)</div>
<div class="line">        );</div>
<div class="ttc" id="anamespacegismo_html_ab72442c3b5aeef49b3c60f6e9df77110"><div class="ttname"><a href="namespacegismo.html#ab72442c3b5aeef49b3c60f6e9df77110">gismo::give</a></div><div class="ttdeci">S give(S &amp;x)</div><div class="ttdef"><b>Definition</b> gsMemory.h:266</div></div>
</div><!-- fragment --><p>Additionally, one can also provide a solver object that realizes \( \tilde A_k^{-1} \), possibly the one which has already been used for the setup of the bases for the primal doefs. By default, again, a LU solver would be used.</p>
<div class="fragment"><div class="line">    } <span class="comment">// end for</span></div>
</div><!-- fragment --><p>Finally, we add \( \tilde B_{K+1} \), \( \tilde A_{K+1} \), and \( \underline{\tilde f}_{K+1} \) to the IETI-system:</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (ietiMapper.nPrimalDofs()&gt;0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// It is not required to provide a local solver to .addSubdomain,</span></div>
<div class="line">        <span class="comment">// since a sparse LU solver would be set up on the fly if required.</span></div>
<div class="line">        <span class="comment">// Here, we make use of the fact that we can use a Cholesky solver</span></div>
<div class="line">        <span class="comment">// because the primal problem is symmetric and positive definite:</span></div>
<div class="line">        <a class="code hl_typedef" href="classgismo_1_1gsLinearOperator.html#a7e083f6c92575f77236d6cb193997e84">gsLinearOperator&lt;&gt;::Ptr</a> localSolver</div>
<div class="line">            = makeSparseCholeskySolver(primal.localMatrix());</div>
<div class="line"> </div>
<div class="line">        ieti.addSubdomain(</div>
<div class="line">            primal.jumpMatrix().moveToPtr(),</div>
<div class="line">            makeMatrixOp(primal.localMatrix().moveToPtr()),</div>
<div class="line">            <a class="code hl_function" href="namespacegismo.html#ab72442c3b5aeef49b3c60f6e9df77110">give</a>(primal.localRhs()),</div>
<div class="line">            localSolver</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="ttc" id="aclassgismo_1_1gsLinearOperator_html_a7e083f6c92575f77236d6cb193997e84"><div class="ttname"><a href="classgismo_1_1gsLinearOperator.html#a7e083f6c92575f77236d6cb193997e84">gismo::gsLinearOperator::Ptr</a></div><div class="ttdeci">memory::shared_ptr&lt; gsLinearOperator &gt; Ptr</div><div class="ttdoc">Shared pointer for gsLinearOperator.</div><div class="ttdef"><b>Definition</b> gsLinearOperator.h:33</div></div>
</div><!-- fragment --><p>The <em><a class="el" href="classgismo_1_1gsScaledDirichletPrec.html" title="This class represents the scaled Dirichlet preconditioner for a IETI problem.">gsScaledDirichletPrec</a></em> can automatically compute the multiplicity scaling. Other scaling matrices can be manually defined.</p>
<div class="fragment"><div class="line">    prec.setupMultiplicityScaling();</div>
</div><!-- fragment --><p>Now, we compute the right-hand-side  </p><p class="formulaDsp">
\[
    \underline g = \sum_{k=1}^{K+1} \tilde B_k \tilde A_k^{-1} \underline{\tilde f}_k.
\]
</p>
<div class="fragment"><div class="line">    gsMatrix&lt;&gt; rhsForSchur = ieti.rhsForSchurComplement();</div>
</div><!-- fragment --><p>We choose a random initial guess.</p>
<div class="fragment"><div class="line">    gsMatrix&lt;&gt; lambda;</div>
<div class="line">    lambda.setRandom( ieti.nLagrangeMultipliers(), 1 );</div>
</div><!-- fragment --><p>As a next step, we solve the problem  </p><p class="formulaDsp">
\[
      F \underline \lambda = \underline g
\]
</p>
<p> using the scaled Dirichlet preconditioner with a conjugate gradient solver.</p>
<div class="fragment"><div class="line">    gsConjugateGradient&lt;&gt; PCG( ieti.schurComplement(), prec.preconditioner() );</div>
<div class="line">    PCG.setOptions( cmd.getGroup(<span class="stringliteral">&quot;Solver&quot;</span>) ).solveDetailed( rhsForSchur, lambda, errorHistory );</div>
</div><!-- fragment --><p>So far, we have only computed the Lagrange multipliers \( \underline \lambda \), from which we want to recover the solution.</p>
<p>Here, we first compute the solutions \( \underline{\tilde u}_k \) for \( k=1,\ldots,K+1 \). Here, the first K solutions refer to the patches and have homogenous values for the primal dofs. So, we distribute the primal dof values from the primal problem (= last subdomain) to the patches (=first K subdomains) and obtain the solutions \( \underline u_k \) for \( k=1,\ldots,K \). Then, finally, the IETI mapper is able to combine everything into one solution vector \( \underline u \).</p>
<div class="fragment"><div class="line">    std::vector&lt;gsMatrix&lt;&gt;&gt; uLocal = primal.distributePrimalSolution(</div>
<div class="line">        ieti.constructSolutionFromLagrangeMultipliers(lambda)</div>
<div class="line">    );</div>
<div class="line">    gsMatrix&lt;&gt; uGlobal = ietiMapper.constructGlobalSolutionFromLocalSolutions(uLocal);</div>
</div><!-- fragment --><h1><a class="anchor" id="ieti_exampleAnnotated"></a>
Annotated source file</h1>
<p>Here is the full file <code>examples/ieti_example.cpp</code>. Clicking on a function or class name will lead you to its reference documentation.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ctime&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="gismo_8h.html">gismo.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacegismo.html">gismo</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="comment">    /************** Define command line options *************/</span></div>
<div class="line"> </div>
<div class="line">    std::string geometry(<span class="stringliteral">&quot;domain2d/yeti_mp2.xml&quot;</span>);</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> splitPatches = 1;</div>
<div class="line">    real_t stretchGeometry = 1;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> refinements = 1;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> degree = 2;</div>
<div class="line">    std::string boundaryConditions(<span class="stringliteral">&quot;d&quot;</span>);</div>
<div class="line">    std::string primals(<span class="stringliteral">&quot;c&quot;</span>);</div>
<div class="line">    <span class="keywordtype">bool</span> eliminateCorners = <span class="keyword">false</span>;</div>
<div class="line">    real_t tolerance = 1.e-8;</div>
<div class="line">    <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> maxIterations = 100;</div>
<div class="line">    <span class="keywordtype">bool</span> calcEigenvalues = <span class="keyword">false</span>;</div>
<div class="line">    std::string out;</div>
<div class="line">    <span class="keywordtype">bool</span> plot = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsCmdLine.html">gsCmdLine</a> cmd(<span class="stringliteral">&quot;Solves a PDE with an isogeometric discretization using an isogeometric tearing and interconnecting (IETI) solver.&quot;</span>);</div>
<div class="line">    cmd.addString(<span class="stringliteral">&quot;g&quot;</span>, <span class="stringliteral">&quot;Geometry&quot;</span>,              <span class="stringliteral">&quot;Geometry file&quot;</span>, geometry);</div>
<div class="line">    cmd.addInt   (<span class="stringliteral">&quot;&quot;</span>,  <span class="stringliteral">&quot;SplitPatches&quot;</span>,          <span class="stringliteral">&quot;Split every patch that many times in 2^d patches&quot;</span>, splitPatches);</div>
<div class="line">    cmd.addReal  (<span class="stringliteral">&quot;&quot;</span>,  <span class="stringliteral">&quot;StretchGeometry&quot;</span>,       <span class="stringliteral">&quot;Stretch geometry in x-direction by the given factor&quot;</span>, stretchGeometry);</div>
<div class="line">    cmd.addInt   (<span class="stringliteral">&quot;r&quot;</span>, <span class="stringliteral">&quot;Refinements&quot;</span>,           <span class="stringliteral">&quot;Number of uniform h-refinement steps to perform before solving&quot;</span>, refinements);</div>
<div class="line">    cmd.addInt   (<span class="stringliteral">&quot;p&quot;</span>, <span class="stringliteral">&quot;Degree&quot;</span>,                <span class="stringliteral">&quot;Degree of the B-spline discretization space&quot;</span>, degree);</div>
<div class="line">    cmd.addString(<span class="stringliteral">&quot;b&quot;</span>, <span class="stringliteral">&quot;BoundaryConditions&quot;</span>,    <span class="stringliteral">&quot;Boundary conditions&quot;</span>, boundaryConditions);</div>
<div class="line">    cmd.addString(<span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;Primals&quot;</span>,               <span class="stringliteral">&quot;Primal constraints (c=corners, e=edges, f=faces)&quot;</span>, primals);</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;e&quot;</span>, <span class="stringliteral">&quot;EliminateCorners&quot;</span>,      <span class="stringliteral">&quot;Eliminate corners (if they are primals)&quot;</span>, eliminateCorners);</div>
<div class="line">    cmd.addReal  (<span class="stringliteral">&quot;t&quot;</span>, <span class="stringliteral">&quot;Solver.Tolerance&quot;</span>,      <span class="stringliteral">&quot;Stopping criterion for linear solver&quot;</span>, tolerance);</div>
<div class="line">    cmd.addInt   (<span class="stringliteral">&quot;&quot;</span>,  <span class="stringliteral">&quot;Solver.MaxIterations&quot;</span>,  <span class="stringliteral">&quot;Maximum iterations for linear solver&quot;</span>, maxIterations);</div>
<div class="line">    cmd.addSwitch(<span class="stringliteral">&quot;&quot;</span>,  <span class="stringliteral">&quot;Solver.CalcEigenvalues&quot;</span>,<span class="stringliteral">&quot;Estimate eigenvalues based on Lanczos&quot;</span>, calcEigenvalues);</div>
<div class="line">    cmd.addString(<span class="stringliteral">&quot;&quot;</span>,  <span class="stringliteral">&quot;out&quot;</span>,                   <span class="stringliteral">&quot;Write solution and used options to file&quot;</span>, out);</div>
<div class="line">    cmd.addSwitch(     <span class="stringliteral">&quot;plot&quot;</span>,                  <span class="stringliteral">&quot;Plot the result with Paraview&quot;</span>, plot);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> { cmd.getValues(argc,argv); } <span class="keywordflow">catch</span> (<span class="keywordtype">int</span> rv) { <span class="keywordflow">return</span> rv; }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ( ! <a class="code hl_function" href="classgismo_1_1gsFileManager.html#a8da6832660ffb6bbf974846015f44a21">gsFileManager::fileExists</a>(geometry) )</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Geometry file could not be found.\n&quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;I was searching in the current directory and in: &quot;</span> &lt;&lt; <a class="code hl_function" href="classgismo_1_1gsFileManager.html#a76962c9181651d5335c0712a38f0e6a6">gsFileManager::getSearchPaths</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Run ieti_example with options:\n&quot;</span> &lt;&lt; cmd &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /******************* Define geometry ********************/</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Define geometry... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="classgismo_1_1gsMultiPatch.html#ad7190c68d8ead80bd1b6fd7256779894">gsMultiPatch&lt;&gt;::uPtr</a> mpPtr = <a class="code hl_class" href="classgismo_1_1gsReadFile.html">gsReadFile&lt;&gt;</a>(geometry);</div>
<div class="line">    <span class="keywordflow">if</span> (!mpPtr)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;No geometry found in file &quot;</span> &lt;&lt; geometry &lt;&lt; <span class="stringliteral">&quot;.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMultiPatch.html">gsMultiPatch&lt;&gt;</a>&amp; mp = *mpPtr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i=0; i&lt;splitPatches; ++i)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;split patches uniformly... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">        mp = mp.uniformSplit();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (stretchGeometry!=1)</div>
<div class="line">    {</div>
<div class="line">       <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;and stretch it... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">       <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i!=mp.nPatches(); ++i)</div>
<div class="line">           <span class="keyword">const_cast&lt;</span><a class="code hl_class" href="classgismo_1_1gsGeometry.html">gsGeometry&lt;&gt;</a>&amp;<span class="keyword">&gt;</span>(mp[i]).<a class="code hl_function" href="classgismo_1_1gsGeometry.html#a43e34549f7cc019b808fc40fd6a7a05f">scale</a>(stretchGeometry,0);</div>
<div class="line">       <span class="comment">// Const cast is allowed since the object itself is not const. Stretching the</span></div>
<div class="line">       <span class="comment">// overall domain keeps its topology.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /************** Define boundary conditions **************/</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Define right-hand-side and boundary conditions... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Right-hand-side</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsFunctionExpr.html">gsFunctionExpr&lt;&gt;</a> f( <span class="stringliteral">&quot;2*sin(x)*cos(y)&quot;</span>, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Dirichlet function</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsFunctionExpr.html">gsFunctionExpr&lt;&gt;</a> gD( <span class="stringliteral">&quot;sin(x)*cos(y)&quot;</span>, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Neumann</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsConstantFunction.html">gsConstantFunction&lt;&gt;</a> gN( 1.0, mp.geoDim() );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsBoundaryConditions.html">gsBoundaryConditions&lt;&gt;</a> bc;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> len = boundaryConditions.length();</div>
<div class="line">        <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (gsMultiPatch&lt;&gt;::const_biterator it = mp.bBegin(); it &lt; mp.bEnd(); ++it)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordtype">char</span> b_local;</div>
<div class="line">            <span class="keywordflow">if</span> ( len == 1 )</div>
<div class="line">                b_local = boundaryConditions[0];</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i &lt; len )</div>
<div class="line">                b_local = boundaryConditions[i];</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;\nNot enough boundary conditions given.\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> ( b_local == <span class="charliteral">&#39;d&#39;</span> )</div>
<div class="line">                bc.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#a1dd0c4f4cdae8082d37db999fc3932d2">addCondition</a>( *it, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">condition_type::dirichlet</a>, &amp;gD );</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( b_local == <span class="charliteral">&#39;n&#39;</span> )</div>
<div class="line">                bc.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#a1dd0c4f4cdae8082d37db999fc3932d2">addCondition</a>( *it, <a class="code hl_enumvalue" href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da8e855db37d5c0fbd8eda96b2f51b8b20">condition_type::neumann</a>, &amp;gN );</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;\nInvalid boundary condition given; only &#39;d&#39; (Dirichlet) and &#39;n&#39; (Neumann) are supported.\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            ++i;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ( len &gt; i )</div>
<div class="line">            <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;\nToo many boundary conditions have been specified. Ignoring the remaining ones.\n&quot;</span>;</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done. &quot;</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">&quot; boundary conditions set.\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">    /************ Setup bases and adjust degree *************/</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMultiBasis.html">gsMultiBasis&lt;&gt;</a> mb(mp);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Setup bases and adjust degree... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> i = 0; i &lt; mb.nBases(); ++ i )</div>
<div class="line">        mb[i].setDegreePreservingMultiplicity(degree);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> ( <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> i = 0; i &lt; refinements; ++i )</div>
<div class="line">        mb.uniformRefine();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /********* Setup assembler and assemble matrix **********/</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Setup assembler and assemble matrix... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> nPatches = mp.nPatches();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsIetiMapper.html">gsIetiMapper&lt;&gt;</a> ietiMapper;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We start by setting up a global FeSpace that allows us to</span></div>
<div class="line">    <span class="comment">// obtain a dof mapper and the Dirichlet data</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_class" href="classgismo_1_1expr_1_1gsFeSpace.html">gsExprAssembler&lt;&gt;::space</a>  space;</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsExprAssembler.html">gsExprAssembler&lt;&gt;</a> assembler;</div>
<div class="line">        space u = assembler.getSpace(mb);</div>
<div class="line">        bc.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#aff5423866bbe8b3870298fcef256a321">setGeoMap</a>(mp);</div>
<div class="line">        u.setup(bc, dirichlet::interpolation, 0);</div>
<div class="line">        ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a47f5cdc8185504d5d16a5ccb1e085b63">init</a>( mb, u.mapper(), u.fixedPart() );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Which primal dofs should we choose?</span></div>
<div class="line">    <span class="keywordtype">bool</span> cornersAsPrimals = <span class="keyword">false</span>, edgesAsPrimals = <span class="keyword">false</span>, facesAsPrimals = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;primals.length(); ++i)</div>
<div class="line">        <span class="keywordflow">switch</span> (primals[i])</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>: cornersAsPrimals = <span class="keyword">true</span>;   <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: edgesAsPrimals = <span class="keyword">true</span>;     <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: facesAsPrimals = <span class="keyword">true</span>;     <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;\nUnkown type of primal constraint: \&quot;&quot;</span> &lt;&lt; primals[i] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We tell the ieti mapper which primal constraints we want; calling</span></div>
<div class="line">    <span class="comment">// more than one such function is possible.</span></div>
<div class="line">    <span class="keywordflow">if</span> (cornersAsPrimals)</div>
<div class="line">        ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a34c2d7066cb0c6bcee1cbd131c1603f9">cornersAsPrimals</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (edgesAsPrimals)</div>
<div class="line">        ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a2ac4b4004601ebd2758fd6f54100d896">interfaceAveragesAsPrimals</a>(mp,1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (facesAsPrimals)</div>
<div class="line">        ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a2ac4b4004601ebd2758fd6f54100d896">interfaceAveragesAsPrimals</a>(mp,2);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Compute the jump matrices</span></div>
<div class="line">    <span class="keywordtype">bool</span> fullyRedundant = <span class="keyword">true</span>,</div>
<div class="line">         noLagrangeMultipliersForCorners = cornersAsPrimals;</div>
<div class="line">    ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a23e4453503baee19fa458314bc6a317d">computeJumpMatrices</a>(fullyRedundant, noLagrangeMultipliersForCorners);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The ieti system does not have a special treatment for the</span></div>
<div class="line">    <span class="comment">// primal dofs. They are just one more subdomain</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsIetiSystem.html">gsIetiSystem&lt;&gt;</a> ieti;</div>
<div class="line">    ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#a7ebf485c8ffc385c75b2a9369edabd49">reserve</a>(nPatches+1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The scaled Dirichlet preconditioner is independent of the</span></div>
<div class="line">    <span class="comment">// primal dofs.</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsScaledDirichletPrec.html">gsScaledDirichletPrec&lt;&gt;</a> prec;</div>
<div class="line">    prec.<a class="code hl_function" href="classgismo_1_1gsScaledDirichletPrec.html#a7ebf485c8ffc385c75b2a9369edabd49">reserve</a>(nPatches);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup the primal system, which needs to know the number of primal dofs.</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsPrimalSystem.html">gsPrimalSystem&lt;&gt;</a> primal(ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#aa594441b8000ed8f7bc13fc646988bec">nPrimalDofs</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (eliminateCorners)</div>
<div class="line">        primal.setEliminatePointwiseConstraints(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> k=0; k&lt;nPatches; ++k)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We use the local variants of everything</span></div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsBoundaryConditions.html">gsBoundaryConditions&lt;&gt;</a> bc_local;</div>
<div class="line">        bc.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#a119d313b7f45107db2c3786f9c1533e4">getConditionsForPatch</a>(k,bc_local);</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsMultiPatch.html">gsMultiPatch&lt;&gt;</a> mp_local = mp[k];</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsMultiBasis.html">gsMultiBasis&lt;&gt;</a> mb_local = mb[k];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// The usual stuff for the expression assembler</span></div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#a16c60fa6666b6a61c747b016c385a4e2">gsExprAssembler&lt;&gt;::geometryMap</a> geometryMap;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_class" href="classgismo_1_1expr_1_1gsFeVariable.html">gsExprAssembler&lt;&gt;::variable</a>    variable;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_class" href="classgismo_1_1expr_1_1gsFeSpace.html">gsExprAssembler&lt;&gt;::space</a>       space;</div>
<div class="line">        <span class="keyword">typedef</span> <a class="code hl_typedef" href="classgismo_1_1gsExprAssembler.html#aa2c9456b2c52d7b912894815a3c593da">gsExprAssembler&lt;&gt;::solution</a>    solution;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We set up the assembler</span></div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsExprAssembler.html">gsExprAssembler&lt;&gt;</a> assembler(1,1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Elements used for numerical integration</span></div>
<div class="line">        assembler.setIntegrationElements(mb_local);</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsExprEvaluator.html">gsExprEvaluator&lt;&gt;</a> ev(assembler);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the geometry map</span></div>
<div class="line">        geometryMap G = assembler.getMap(mp_local);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the discretization space</span></div>
<div class="line">        space u = assembler.getSpace(mb_local);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Incorporate Dirichlet BC</span></div>
<div class="line">        bc_local.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#aff5423866bbe8b3870298fcef256a321">setGeoMap</a>(mp_local);</div>
<div class="line">        u.setup(bc_local, dirichlet::interpolation, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// This function provides a new dof mapper and the Dirichlet data</span></div>
<div class="line">        <span class="comment">// This is necessary since it might happen that a 2d-patch touches the</span></div>
<div class="line">        <span class="comment">// Dirichlet boundary just with a corner or that a 3d-patch touches the</span></div>
<div class="line">        <span class="comment">// Dirichlet boundary with a corner or an edge. These cases are not</span></div>
<div class="line">        <span class="comment">// covered by bc.getConditionsForPatch</span></div>
<div class="line">        ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#af7df92fd1de0cc08688553d8f0ae2692">initFeSpace</a>(u,k);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set the source term</span></div>
<div class="line">        <span class="keyword">auto</span> ff = assembler.getCoeff(f, G);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Initialize the system</span></div>
<div class="line">        assembler.initSystem();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Compute the system matrix and right-hand side</span></div>
<div class="line">        assembler.assemble( igrad(u, G) * igrad(u, G).tr() * <a class="code hl_function" href="namespacegismo_1_1expr.html#a37e91c8b6c3efac383e28a3cb2b5f092">meas</a>(G), u * ff * <a class="code hl_function" href="namespacegismo_1_1expr.html#a37e91c8b6c3efac383e28a3cb2b5f092">meas</a>(G) );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add contributions from Neumann conditions to right-hand side</span></div>
<div class="line">        variable g_N = assembler.getBdrFunction();</div>
<div class="line">        assembler.assembleBdr(bc_local.<a class="code hl_function" href="classgismo_1_1gsBoundaryConditions.html#a1f133186105f0c803091e877d2487876">get</a>(<span class="stringliteral">&quot;Neumann&quot;</span>),  u * g_N.val() * <a class="code hl_function" href="namespacegismo_1_1expr.html#a4e9183c7344f01357cf9071a0e508fde">nv</a>(G).norm() );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fetch data</span></div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsSparseMatrix.html">gsSparseMatrix&lt;real_t, RowMajor&gt;</a> jumpMatrix  = ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#aca458c464f2cfc1bc96902f216dd4c36">jumpMatrix</a>(k);</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsSparseMatrix.html">gsSparseMatrix&lt;&gt;</a>                 localMatrix = assembler.matrix();</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;&gt;</a>                       localRhs    = assembler.rhs();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add the patch to the scaled Dirichlet preconditioner</span></div>
<div class="line">        prec.<a class="code hl_function" href="classgismo_1_1gsScaledDirichletPrec.html#a6576e33b303fa0efb7b7ef8e3a6bc3f9">addSubdomain</a>(</div>
<div class="line">            <a class="code hl_class" href="classgismo_1_1gsScaledDirichletPrec.html">gsScaledDirichletPrec&lt;&gt;::restrictToSkeleton</a>(</div>
<div class="line">                jumpMatrix,</div>
<div class="line">                localMatrix,</div>
<div class="line">                ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#ab3cab174cd281fbf6d987337e61fd826">skeletonDofs</a>(k)</div>
<div class="line">            )</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// This function writes back to jumpMatrix, localMatrix, and localRhs,</span></div>
<div class="line">        <span class="comment">// so it must be called after prec.addSubdomain().</span></div>
<div class="line">        primal.handleConstraints(</div>
<div class="line">            ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#ad38d69af76a1fd5b9c945e895212b376">primalConstraints</a>(k),</div>
<div class="line">            ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a5d81b2ed67bae02681088507d0e55928">primalDofIndices</a>(k),</div>
<div class="line">            jumpMatrix,</div>
<div class="line">            localMatrix,</div>
<div class="line">            localRhs</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add the patch to the Ieti system</span></div>
<div class="line">        ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#a61e3b879da178aeaf79e2db044df337e">addSubdomain</a>(</div>
<div class="line">            jumpMatrix.<a class="code hl_function" href="classgismo_1_1gsSparseMatrix.html#a24da616b328c15186de32aa2c9a51938">moveToPtr</a>(),</div>
<div class="line">            makeMatrixOp(localMatrix.<a class="code hl_function" href="classgismo_1_1gsSparseMatrix.html#a24da616b328c15186de32aa2c9a51938">moveToPtr</a>()),</div>
<div class="line">            <a class="code hl_function" href="namespacegismo.html#ab72442c3b5aeef49b3c60f6e9df77110">give</a>(localRhs)</div>
<div class="line">        );</div>
<div class="line">    } <span class="comment">// end for</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add the primal problem if there are primal constraints</span></div>
<div class="line">    <span class="keywordflow">if</span> (ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#aa594441b8000ed8f7bc13fc646988bec">nPrimalDofs</a>()&gt;0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// It is not required to provide a local solver to .addSubdomain,</span></div>
<div class="line">        <span class="comment">// since a sparse LU solver would be set up on the fly if required.</span></div>
<div class="line">        <span class="comment">// Here, we make use of the fact that we can use a Cholesky solver</span></div>
<div class="line">        <span class="comment">// because the primal problem is symmetric and positive definite:</span></div>
<div class="line">        <a class="code hl_typedef" href="classgismo_1_1gsLinearOperator.html#a7e083f6c92575f77236d6cb193997e84">gsLinearOperator&lt;&gt;::Ptr</a> localSolver</div>
<div class="line">            = makeSparseCholeskySolver(primal.localMatrix());</div>
<div class="line"> </div>
<div class="line">        ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#a61e3b879da178aeaf79e2db044df337e">addSubdomain</a>(</div>
<div class="line">            primal.jumpMatrix().moveToPtr(),</div>
<div class="line">            makeMatrixOp(primal.localMatrix().moveToPtr()),</div>
<div class="line">            <a class="code hl_function" href="namespacegismo.html#ab72442c3b5aeef49b3c60f6e9df77110">give</a>(primal.localRhs()),</div>
<div class="line">            localSolver</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done. &quot;</span> &lt;&lt; ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#aa594441b8000ed8f7bc13fc646988bec">nPrimalDofs</a>() &lt;&lt; <span class="stringliteral">&quot; primal dofs.\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /**************** Setup solver and solve ****************/</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Setup solver and solve... \n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    Setup multiplicity scaling... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Tell the preconditioner to set up the scaling</span></div>
<div class="line">    prec.<a class="code hl_function" href="classgismo_1_1gsScaledDirichletPrec.html#acaa221022cd4b0107af70d2e4d354699">setupMultiplicityScaling</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n    Setup rhs... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="comment">// Compute the Schur-complement contribution for the right-hand-side</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;&gt;</a> rhsForSchur = ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#ae5a999a00f2c2b6388e35bd0cb3327fb">rhsForSchurComplement</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n    Setup cg solver for Lagrange multipliers and solve... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="comment">// Initial guess</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;&gt;</a> lambda;</div>
<div class="line">    lambda.setRandom( ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#afb71515dac55fb71df1f54e2c11e17d3">nLagrangeMultipliers</a>(), 1 );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;&gt;</a> errorHistory;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This is the main cg iteration</span></div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsConjugateGradient.html">gsConjugateGradient&lt;&gt;</a> PCG( ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#a0a5d5a8299ab6a12765afffe40bdc8a8">schurComplement</a>(), prec.<a class="code hl_function" href="classgismo_1_1gsScaledDirichletPrec.html#a2b5388ceb650e63fe7f570f2e3ce3326">preconditioner</a>() );</div>
<div class="line">    PCG.setOptions( cmd.getGroup(<span class="stringliteral">&quot;Solver&quot;</span>) ).solveDetailed( rhsForSchur, lambda, errorHistory );</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n    Reconstruct solution from Lagrange multipliers... &quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="comment">// Now, we want to have the global solution for u</span></div>
<div class="line">    std::vector&lt;gsMatrix&lt;&gt;&gt; uLocal = primal.distributePrimalSolution(</div>
<div class="line">        ieti.<a class="code hl_function" href="classgismo_1_1gsIetiSystem.html#af6fe2b719cb8a981b88c6f89863030a3">constructSolutionFromLagrangeMultipliers</a>(lambda)</div>
<div class="line">    );</div>
<div class="line">    <a class="code hl_class" href="classgismo_1_1gsMatrix.html">gsMatrix&lt;&gt;</a> uGlobal = ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a544a4ee495de0bb8dddcb2c80e4dba38">constructGlobalSolutionFromLocalSolutions</a>(uLocal);</div>
<div class="line">    <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;done.\n\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">    /******************** Print end Exit ********************/</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> iter = errorHistory.rows()-1;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> success = errorHistory(iter,0) &lt; tolerance;</div>
<div class="line">    <span class="keywordflow">if</span> (success)</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Reached desired tolerance after &quot;</span> &lt;&lt; iter &lt;&lt; <span class="stringliteral">&quot; iterations:\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Did not reach desired tolerance after &quot;</span> &lt;&lt; iter &lt;&lt; <span class="stringliteral">&quot; iterations:\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (errorHistory.rows() &lt; 20)</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; errorHistory.transpose() &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; errorHistory.topRows(5).transpose() &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span> &lt;&lt; errorHistory.bottomRows(5).transpose()  &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (calcEigenvalues)</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Estimated condition number: &quot;</span> &lt;&lt; PCG.getConditionNumber() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!out.empty())</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsFileData.html">gsFileData&lt;&gt;</a> fd;</div>
<div class="line">        std::time_t time = std::time(NULL);</div>
<div class="line">        fd.add(cmd);</div>
<div class="line">        fd.add(uGlobal);</div>
<div class="line">        fd.addComment(std::string(<span class="stringliteral">&quot;ieti_example   Timestamp:&quot;</span>)+std::ctime(&amp;time));</div>
<div class="line">        fd.save(out);</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Write solution to file &quot;</span> &lt;&lt; out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (plot)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Write Paraview data to file ieti_result.pvd\n&quot;</span>;</div>
<div class="line">        <a class="code hl_class" href="classgismo_1_1gsMultiPatch.html">gsMultiPatch&lt;&gt;</a> mpsol;</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code hl_define" href="gsConfig_8h.html#ad722078677c063a09661059674fb996c">index_t</a> k=0; k&lt;nPatches; ++k)</div>
<div class="line">            mpsol.<a class="code hl_function" href="classgismo_1_1gsMultiPatch.html#a9fbe98882789c00c743d121b7f59df52">addPatch</a>( mb[k].makeGeometry( ietiMapper.<a class="code hl_function" href="classgismo_1_1gsIetiMapper.html#a02222f29fab11af9e87a72ec65d28d5d">incorporateFixedPart</a>(k, uLocal[k])  ) );</div>
<div class="line">        gsWriteParaview&lt;&gt;( <a class="code hl_class" href="classgismo_1_1gsField.html">gsField&lt;&gt;</a>( mp, mpsol ), <span class="stringliteral">&quot;ieti_result&quot;</span>, 1000);</div>
<div class="line">        <span class="comment">//gsFileManager::open(&quot;ieti_result.pvd&quot;);</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!plot&amp;&amp;out.empty())</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_define" href="gsDebug_8h.html#af6177e1e282640c3cb9175565f84a432">gsInfo</a> &lt;&lt; <span class="stringliteral">&quot;Done. No output created, re-run with --plot to get a ParaView &quot;</span></div>
<div class="line">                  <span class="stringliteral">&quot;file containing the solution or --out to write solution to xml file.\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> success ? EXIT_SUCCESS : EXIT_FAILURE;</div>
<div class="line">}</div>
<div class="ttc" id="aclassgismo_1_1expr_1_1gsFeSpace_html"><div class="ttname"><a href="classgismo_1_1expr_1_1gsFeSpace.html">gismo::expr::gsFeSpace</a></div><div class="ttdef"><b>Definition</b> gsExpressions.h:973</div></div>
<div class="ttc" id="aclassgismo_1_1expr_1_1gsFeVariable_html"><div class="ttname"><a href="classgismo_1_1expr_1_1gsFeVariable.html">gismo::expr::gsFeVariable</a></div><div class="ttdef"><b>Definition</b> gsExpressions.h:928</div></div>
<div class="ttc" id="aclassgismo_1_1gsBoundaryConditions_html"><div class="ttname"><a href="classgismo_1_1gsBoundaryConditions.html">gismo::gsBoundaryConditions</a></div><div class="ttdoc">Class containing a set of boundary conditions.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:342</div></div>
<div class="ttc" id="aclassgismo_1_1gsBoundaryConditions_html_a119d313b7f45107db2c3786f9c1533e4"><div class="ttname"><a href="classgismo_1_1gsBoundaryConditions.html#a119d313b7f45107db2c3786f9c1533e4">gismo::gsBoundaryConditions::getConditionsForPatch</a></div><div class="ttdeci">void getConditionsForPatch(const index_t np, gsBoundaryConditions &amp;result) const</div><div class="ttdoc">returns the set of all boundary conditions which refer to patch np</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:848</div></div>
<div class="ttc" id="aclassgismo_1_1gsBoundaryConditions_html_a1dd0c4f4cdae8082d37db999fc3932d2"><div class="ttname"><a href="classgismo_1_1gsBoundaryConditions.html#a1dd0c4f4cdae8082d37db999fc3932d2">gismo::gsBoundaryConditions::addCondition</a></div><div class="ttdeci">void addCondition(int p, boxSide s, condition_type::type t, gsFunctionSet&lt; T &gt; *f, short_t unknown=0, bool parametric=false, int comp=-1)</div><div class="ttdoc">Adds another boundary condition.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:650</div></div>
<div class="ttc" id="aclassgismo_1_1gsBoundaryConditions_html_a1f133186105f0c803091e877d2487876"><div class="ttname"><a href="classgismo_1_1gsBoundaryConditions.html#a1f133186105f0c803091e877d2487876">gismo::gsBoundaryConditions::get</a></div><div class="ttdeci">bcRefList get(const std::string &amp;label, const short_t unk=0, int comp=-1) const</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:420</div></div>
<div class="ttc" id="aclassgismo_1_1gsBoundaryConditions_html_aff5423866bbe8b3870298fcef256a321"><div class="ttname"><a href="classgismo_1_1gsBoundaryConditions.html#aff5423866bbe8b3870298fcef256a321">gismo::gsBoundaryConditions::setGeoMap</a></div><div class="ttdeci">void setGeoMap(const gsFunctionSet&lt; T &gt; &amp;gm)</div><div class="ttdoc">Set the geometry map to evaluate boundary conditions.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:916</div></div>
<div class="ttc" id="aclassgismo_1_1gsCmdLine_html"><div class="ttname"><a href="classgismo_1_1gsCmdLine.html">gismo::gsCmdLine</a></div><div class="ttdoc">Class for command-line argument parsing.</div><div class="ttdef"><b>Definition</b> gsCmdLine.h:57</div></div>
<div class="ttc" id="aclassgismo_1_1gsConjugateGradient_html"><div class="ttname"><a href="classgismo_1_1gsConjugateGradient.html">gismo::gsConjugateGradient</a></div><div class="ttdoc">The conjugate gradient method.</div><div class="ttdef"><b>Definition</b> gsConjugateGradient.h:30</div></div>
<div class="ttc" id="aclassgismo_1_1gsConstantFunction_html"><div class="ttname"><a href="classgismo_1_1gsConstantFunction.html">gismo::gsConstantFunction</a></div><div class="ttdoc">Class defining a globally constant function.</div><div class="ttdef"><b>Definition</b> gsConstantFunction.h:34</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprAssembler_html"><div class="ttname"><a href="classgismo_1_1gsExprAssembler.html">gismo::gsExprAssembler</a></div><div class="ttdef"><b>Definition</b> gsExprAssembler.h:33</div></div>
<div class="ttc" id="aclassgismo_1_1gsExprEvaluator_html"><div class="ttname"><a href="classgismo_1_1gsExprEvaluator.html">gismo::gsExprEvaluator</a></div><div class="ttdoc">Generic evaluator of isogeometric expressions.</div><div class="ttdef"><b>Definition</b> gsExprEvaluator.h:39</div></div>
<div class="ttc" id="aclassgismo_1_1gsField_html"><div class="ttname"><a href="classgismo_1_1gsField.html">gismo::gsField</a></div><div class="ttdoc">A scalar of vector field defined on a m_parametric geometry.</div><div class="ttdef"><b>Definition</b> gsField.h:55</div></div>
<div class="ttc" id="aclassgismo_1_1gsFileData_html"><div class="ttname"><a href="classgismo_1_1gsFileData.html">gismo::gsFileData</a></div><div class="ttdoc">This class represents an XML data tree which can be read from or written to a (file) stream.</div><div class="ttdef"><b>Definition</b> gsFileData.h:34</div></div>
<div class="ttc" id="aclassgismo_1_1gsFileManager_html_a76962c9181651d5335c0712a38f0e6a6"><div class="ttname"><a href="classgismo_1_1gsFileManager.html#a76962c9181651d5335c0712a38f0e6a6">gismo::gsFileManager::getSearchPaths</a></div><div class="ttdeci">static std::string getSearchPaths()</div><div class="ttdoc">Get the defined search paths.</div><div class="ttdef"><b>Definition</b> gsFileManager.cpp:271</div></div>
<div class="ttc" id="aclassgismo_1_1gsFileManager_html_a8da6832660ffb6bbf974846015f44a21"><div class="ttname"><a href="classgismo_1_1gsFileManager.html#a8da6832660ffb6bbf974846015f44a21">gismo::gsFileManager::fileExists</a></div><div class="ttdeci">static bool fileExists(const std::string &amp;name)</div><div class="ttdoc">Checks if the file exists.</div><div class="ttdef"><b>Definition</b> gsFileManager.cpp:62</div></div>
<div class="ttc" id="aclassgismo_1_1gsFunctionExpr_html"><div class="ttname"><a href="classgismo_1_1gsFunctionExpr.html">gismo::gsFunctionExpr</a></div><div class="ttdoc">Class defining a multivariate (real or vector) function given by a string mathematical expression.</div><div class="ttdef"><b>Definition</b> gsFunctionExpr.h:52</div></div>
<div class="ttc" id="aclassgismo_1_1gsGeometry_html"><div class="ttname"><a href="classgismo_1_1gsGeometry.html">gismo::gsGeometry</a></div><div class="ttdoc">Abstract base class representing a geometry map.</div><div class="ttdef"><b>Definition</b> gsGeometry.h:93</div></div>
<div class="ttc" id="aclassgismo_1_1gsGeometry_html_a43e34549f7cc019b808fc40fd6a7a05f"><div class="ttname"><a href="classgismo_1_1gsGeometry.html#a43e34549f7cc019b808fc40fd6a7a05f">gismo::gsGeometry::scale</a></div><div class="ttdeci">void scale(T s, int coord=-1)</div><div class="ttdoc">Apply Scaling by factor s.</div><div class="ttdef"><b>Definition</b> gsGeometry.h:413</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html">gismo::gsIetiMapper</a></div><div class="ttdoc">Ieti Mapper.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:50</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a02222f29fab11af9e87a72ec65d28d5d"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a02222f29fab11af9e87a72ec65d28d5d">gismo::gsIetiMapper::incorporateFixedPart</a></div><div class="ttdeci">Matrix incorporateFixedPart(index_t k, const gsMatrix&lt; T &gt; &amp;localSolution) const</div><div class="ttdoc">Incorporates fixedPart (eg. from eliminated Dirichlet dofs) to given patch-local solution.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:400</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a23e4453503baee19fa458314bc6a317d"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a23e4453503baee19fa458314bc6a317d">gismo::gsIetiMapper::computeJumpMatrices</a></div><div class="ttdeci">void computeJumpMatrices(bool fullyRedundant, bool excludeCorners)</div><div class="ttdoc">This function computes the jump matrices.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:297</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a2ac4b4004601ebd2758fd6f54100d896"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a2ac4b4004601ebd2758fd6f54100d896">gismo::gsIetiMapper::interfaceAveragesAsPrimals</a></div><div class="ttdeci">void interfaceAveragesAsPrimals(const gsMultiPatch&lt; T &gt; &amp;geo, short_t d)</div><div class="ttdoc">Set up interface averages as primal dofs.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:218</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a34c2d7066cb0c6bcee1cbd131c1603f9"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a34c2d7066cb0c6bcee1cbd131c1603f9">gismo::gsIetiMapper::cornersAsPrimals</a></div><div class="ttdeci">void cornersAsPrimals()</div><div class="ttdoc">Set up the corners as primal dofs.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:126</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a47f5cdc8185504d5d16a5ccb1e085b63"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a47f5cdc8185504d5d16a5ccb1e085b63">gismo::gsIetiMapper::init</a></div><div class="ttdeci">void init(const gsMultiBasis&lt; T &gt; &amp;multiBasis, gsDofMapper dofMapperGlobal, const Matrix &amp;fixedPart)</div><div class="ttdoc">Init the ieti mapper after default construction.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:30</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a544a4ee495de0bb8dddcb2c80e4dba38"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a544a4ee495de0bb8dddcb2c80e4dba38">gismo::gsIetiMapper::constructGlobalSolutionFromLocalSolutions</a></div><div class="ttdeci">Matrix constructGlobalSolutionFromLocalSolutions(const std::vector&lt; Matrix &gt; &amp;localContribs)</div><div class="ttdoc">Construct the global solution from a vector of patch-local ones.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:91</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_a5d81b2ed67bae02681088507d0e55928"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#a5d81b2ed67bae02681088507d0e55928">gismo::gsIetiMapper::primalDofIndices</a></div><div class="ttdeci">const std::vector&lt; index_t &gt; &amp; primalDofIndices(index_t k) const</div><div class="ttdoc">Returns the indices of the primal dofs that are associated to the primal constraints for the given pa...</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:164</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_aa594441b8000ed8f7bc13fc646988bec"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#aa594441b8000ed8f7bc13fc646988bec">gismo::gsIetiMapper::nPrimalDofs</a></div><div class="ttdeci">index_t nPrimalDofs() const</div><div class="ttdoc">Returns the size of the primal problem (number of primal dofs)</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:154</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_ab3cab174cd281fbf6d987337e61fd826"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#ab3cab174cd281fbf6d987337e61fd826">gismo::gsIetiMapper::skeletonDofs</a></div><div class="ttdeci">std::vector&lt; index_t &gt; skeletonDofs(index_t patch) const</div><div class="ttdoc">Returns a list of dofs that are (on the coarse level) coupled.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.hpp:282</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_aca458c464f2cfc1bc96902f216dd4c36"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#aca458c464f2cfc1bc96902f216dd4c36">gismo::gsIetiMapper::jumpMatrix</a></div><div class="ttdeci">const JumpMatrix &amp; jumpMatrix(index_t k) const</div><div class="ttdoc">Returns the jump matrix  for the given patch Only available after computeJumpMatrices has been called...</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:168</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_ad38d69af76a1fd5b9c945e895212b376"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#ad38d69af76a1fd5b9c945e895212b376">gismo::gsIetiMapper::primalConstraints</a></div><div class="ttdeci">const std::vector&lt; SparseVector &gt; &amp; primalConstraints(index_t k) const</div><div class="ttdoc">Returns the primalConstraints (as vectors) for the given patch.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:160</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiMapper_html_af7df92fd1de0cc08688553d8f0ae2692"><div class="ttname"><a href="classgismo_1_1gsIetiMapper.html#af7df92fd1de0cc08688553d8f0ae2692">gismo::gsIetiMapper::initFeSpace</a></div><div class="ttdeci">void initFeSpace(typename gsExprAssembler&lt; T &gt;::space u, index_t k)</div><div class="ttdoc">Apply the required changes to a space object of the expression assembler.</div><div class="ttdef"><b>Definition</b> gsIetiMapper.h:130</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html">gismo::gsIetiSystem</a></div><div class="ttdoc">This class represents a IETI system.</div><div class="ttdef"><b>Definition</b> gsIetiSystem.h:70</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_a0a5d5a8299ab6a12765afffe40bdc8a8"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#a0a5d5a8299ab6a12765afffe40bdc8a8">gismo::gsIetiSystem::schurComplement</a></div><div class="ttdeci">OpPtr schurComplement() const</div><div class="ttdoc">Returns gsLinearOperator that represents the Schur complement for the IETI problem.</div><div class="ttdef"><b>Definition</b> gsIetiSystem.hpp:83</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_a61e3b879da178aeaf79e2db044df337e"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#a61e3b879da178aeaf79e2db044df337e">gismo::gsIetiSystem::addSubdomain</a></div><div class="ttdeci">void addSubdomain(JumpMatrixPtr jumpMatrix, OpPtr localMatrixOp, Matrix localRhs, OpPtr localSolverOp=OpPtr())</div><div class="ttdef"><b>Definition</b> gsIetiSystem.hpp:32</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_a7ebf485c8ffc385c75b2a9369edabd49"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#a7ebf485c8ffc385c75b2a9369edabd49">gismo::gsIetiSystem::reserve</a></div><div class="ttdeci">void reserve(index_t n)</div><div class="ttdoc">Reserves the memory required to store the number of subdomains.</div><div class="ttdef"><b>Definition</b> gsIetiSystem.hpp:23</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_ae5a999a00f2c2b6388e35bd0cb3327fb"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#ae5a999a00f2c2b6388e35bd0cb3327fb">gismo::gsIetiSystem::rhsForSchurComplement</a></div><div class="ttdeci">Matrix rhsForSchurComplement() const</div><div class="ttdoc">Returns the right-hand-side that is required for the Schur complement formulation of the IETI problem...</div><div class="ttdef"><b>Definition</b> gsIetiSystem.hpp:91</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_af6fe2b719cb8a981b88c6f89863030a3"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#af6fe2b719cb8a981b88c6f89863030a3">gismo::gsIetiSystem::constructSolutionFromLagrangeMultipliers</a></div><div class="ttdeci">std::vector&lt; Matrix &gt; constructSolutionFromLagrangeMultipliers(const Matrix &amp;multipliers) const</div><div class="ttdoc">Returns the local solutions for the individual subdomains.</div><div class="ttdef"><b>Definition</b> gsIetiSystem.hpp:107</div></div>
<div class="ttc" id="aclassgismo_1_1gsIetiSystem_html_afb71515dac55fb71df1f54e2c11e17d3"><div class="ttname"><a href="classgismo_1_1gsIetiSystem.html#afb71515dac55fb71df1f54e2c11e17d3">gismo::gsIetiSystem::nLagrangeMultipliers</a></div><div class="ttdeci">index_t nLagrangeMultipliers() const</div><div class="ttdoc">Returns the number of Lagrange multipliers.</div><div class="ttdef"><b>Definition</b> gsIetiSystem.h:116</div></div>
<div class="ttc" id="aclassgismo_1_1gsMatrix_html"><div class="ttname"><a href="classgismo_1_1gsMatrix.html">gismo::gsMatrix</a></div><div class="ttdoc">A matrix with arbitrary coefficient type and fixed or dynamic size.</div><div class="ttdef"><b>Definition</b> gsMatrix.h:41</div></div>
<div class="ttc" id="aclassgismo_1_1gsMultiBasis_html"><div class="ttname"><a href="classgismo_1_1gsMultiBasis.html">gismo::gsMultiBasis</a></div><div class="ttdoc">Holds a set of patch-wise bases and their topology information.</div><div class="ttdef"><b>Definition</b> gsMultiBasis.h:37</div></div>
<div class="ttc" id="aclassgismo_1_1gsMultiPatch_html"><div class="ttname"><a href="classgismo_1_1gsMultiPatch.html">gismo::gsMultiPatch</a></div><div class="ttdoc">Container class for a set of geometry patches and their topology, that is, the interface connections ...</div><div class="ttdef"><b>Definition</b> gsMultiPatch.h:100</div></div>
<div class="ttc" id="aclassgismo_1_1gsMultiPatch_html_a9fbe98882789c00c743d121b7f59df52"><div class="ttname"><a href="classgismo_1_1gsMultiPatch.html#a9fbe98882789c00c743d121b7f59df52">gismo::gsMultiPatch::addPatch</a></div><div class="ttdeci">index_t addPatch(typename gsGeometry&lt; T &gt;::uPtr g)</div><div class="ttdoc">Add a patch from a gsGeometry&lt;T&gt;::uPtr.</div><div class="ttdef"><b>Definition</b> gsMultiPatch.hpp:211</div></div>
<div class="ttc" id="aclassgismo_1_1gsPrimalSystem_html"><div class="ttname"><a href="classgismo_1_1gsPrimalSystem.html">gismo::gsPrimalSystem</a></div><div class="ttdoc">This class represents the primal system for a IETI-DP algorithm.</div><div class="ttdef"><b>Definition</b> gsPrimalSystem.h:87</div></div>
<div class="ttc" id="aclassgismo_1_1gsReadFile_html"><div class="ttname"><a href="classgismo_1_1gsReadFile.html">gismo::gsReadFile</a></div><div class="ttdoc">Reads an object from a data file, if such the requested object exists in the file.</div><div class="ttdef"><b>Definition</b> gsReadFile.h:43</div></div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html">gismo::gsScaledDirichletPrec</a></div><div class="ttdoc">This class represents the scaled Dirichlet preconditioner for a IETI problem.</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.h:79</div></div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html_a2b5388ceb650e63fe7f570f2e3ce3326"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html#a2b5388ceb650e63fe7f570f2e3ce3326">gismo::gsScaledDirichletPrec::preconditioner</a></div><div class="ttdeci">OpPtr preconditioner() const</div><div class="ttdoc">This returns the preconditioner as gsLinearOperator.</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.hpp:176</div></div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html_a6576e33b303fa0efb7b7ef8e3a6bc3f9"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html#a6576e33b303fa0efb7b7ef8e3a6bc3f9">gismo::gsScaledDirichletPrec::addSubdomain</a></div><div class="ttdeci">void addSubdomain(JumpMatrixPtr jumpMatrix, OpPtr localSchurOp)</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.h:107</div></div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html_a7ebf485c8ffc385c75b2a9369edabd49"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html#a7ebf485c8ffc385c75b2a9369edabd49">gismo::gsScaledDirichletPrec::reserve</a></div><div class="ttdeci">void reserve(index_t n)</div><div class="ttdoc">Reserves the memory required to store the given number of subdomain.</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.h:90</div></div>
<div class="ttc" id="aclassgismo_1_1gsScaledDirichletPrec_html_acaa221022cd4b0107af70d2e4d354699"><div class="ttname"><a href="classgismo_1_1gsScaledDirichletPrec.html#acaa221022cd4b0107af70d2e4d354699">gismo::gsScaledDirichletPrec::setupMultiplicityScaling</a></div><div class="ttdeci">void setupMultiplicityScaling()</div><div class="ttdoc">This sets up the member vector localScaling based on multiplicity scaling.</div><div class="ttdef"><b>Definition</b> gsScaledDirichletPrec.hpp:149</div></div>
<div class="ttc" id="aclassgismo_1_1gsSparseMatrix_html"><div class="ttname"><a href="classgismo_1_1gsSparseMatrix.html">gismo::gsSparseMatrix</a></div><div class="ttdoc">Sparse matrix class, based on gsEigen::SparseMatrix.</div><div class="ttdef"><b>Definition</b> gsSparseMatrix.h:139</div></div>
<div class="ttc" id="aclassgismo_1_1gsSparseMatrix_html_a24da616b328c15186de32aa2c9a51938"><div class="ttname"><a href="classgismo_1_1gsSparseMatrix.html#a24da616b328c15186de32aa2c9a51938">gismo::gsSparseMatrix::moveToPtr</a></div><div class="ttdeci">uPtr moveToPtr()</div><div class="ttdoc">This function returns a smart pointer to the matrix. After calling it, the matrix object becomes empt...</div><div class="ttdef"><b>Definition</b> gsSparseMatrix.h:247</div></div>
<div class="ttc" id="agismo_8h_html"><div class="ttname"><a href="gismo_8h.html">gismo.h</a></div><div class="ttdoc">Main header to be included by clients using the G+Smo library.</div></div>
<div class="ttc" id="anamespacegismo_1_1expr_html_a37e91c8b6c3efac383e28a3cb2b5f092"><div class="ttname"><a href="namespacegismo_1_1expr.html#a37e91c8b6c3efac383e28a3cb2b5f092">gismo::expr::meas</a></div><div class="ttdeci">EIGEN_STRONG_INLINE meas_expr&lt; T &gt; meas(const gsGeometryMap&lt; T &gt; &amp;G)</div><div class="ttdoc">The measure of a geometry map.</div><div class="ttdef"><b>Definition</b> gsExpressions.h:4555</div></div>
<div class="ttc" id="anamespacegismo_1_1expr_html_a4e9183c7344f01357cf9071a0e508fde"><div class="ttname"><a href="namespacegismo_1_1expr.html#a4e9183c7344f01357cf9071a0e508fde">gismo::expr::nv</a></div><div class="ttdeci">EIGEN_STRONG_INLINE onormal_expr&lt; T &gt; nv(const gsGeometryMap&lt; T &gt; &amp;u)</div><div class="ttdoc">The (outer pointing) boundary normal of a geometry map.</div><div class="ttdef"><b>Definition</b> gsExpressions.h:4506</div></div>
<div class="ttc" id="anamespacegismo_html"><div class="ttname"><a href="namespacegismo.html">gismo</a></div><div class="ttdoc">The G+Smo namespace, containing all definitions for the library.</div></div>
<div class="ttc" id="astructgismo_1_1condition__type_html_a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b"><div class="ttname"><a href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da1b4f535d1f53363637f933002efc2b4b">gismo::condition_type::dirichlet</a></div><div class="ttdeci">@ dirichlet</div><div class="ttdoc">Dirichlet type.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:31</div></div>
<div class="ttc" id="astructgismo_1_1condition__type_html_a7aead736a07eaf25623ad7bfa1f0ee2da8e855db37d5c0fbd8eda96b2f51b8b20"><div class="ttname"><a href="structgismo_1_1condition__type.html#a7aead736a07eaf25623ad7bfa1f0ee2da8e855db37d5c0fbd8eda96b2f51b8b20">gismo::condition_type::neumann</a></div><div class="ttdeci">@ neumann</div><div class="ttdoc">Neumann type.</div><div class="ttdef"><b>Definition</b> gsBoundaryConditions.h:33</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jan 20 2025 09:35:27 for G+Smo by Doxygen v1.9.8 </li>
  </ul>
</div>
<!-- Piwik --> 
<!--
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.sylphide-consulting.com/piwik/" : "http://stats.sylphide-consulting.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 20);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.sylphide-consulting.com/piwik/piwik.php?idsite=20" style="border:0" alt="" /></p></noscript>
-->
<!-- End Piwik Tracking Code -->
</body>
</html>
